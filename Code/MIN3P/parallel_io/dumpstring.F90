!*****Revision Informations Automatically Generated by VisualSVN*****!
!---------------------------------------------------------------------
!> $ID:$
!> $Revision: 371 $
!> $Author: dsu $
!> $Date: 2015-10-09 20:20:18 +0200 (Fri, 09 Oct 2015) $
!> $URL: https://biot.eos.ubc.ca/svn/min3p_thcm/branches/fgerard_new/src/parallel_io/dumpstring.F90 $
!---------------------------------------------------------------------
!********************************************************************!


!> subroutine: dumpstring
!>
!> written by: Danyang Su
!>
!> subroutine description:
!>
!> Convert string to binary output
!>
!> Note: 
    
    !>
    !> Convert ascii string to binary and write to file iunit
    !>
    subroutine dumpstring(iunit, offset, lenstr_plus, instring, b_mpi)
    
        implicit none
#ifdef PETSC_V3_6_X
#include <petsc/finclude/petscsys.h>
#elif PETSC
#include <finclude/petscsys.h>
#endif
        
        !passing variables
        integer*4 :: iunit, lenstr_plus
#ifdef MPI
        integer(kind=MPI_OFFSET_KIND) :: offset
#else
        integer*8 :: offset
#endif
        character(*) :: instring
        logical :: b_mpi
        
       
        !local variables
        integer*4 :: idecs(lenstr_plus)
        integer :: i
        
#ifdef MPI    
        integer :: wstatus(MPI_STATUS_SIZE)
#endif
        integer :: ierrcode

       
        do i=1,lenstr_plus-1
         idecs(i)=ICHAR(instring(i:i))
        end do
        idecs(lenstr_plus) = 0
        
#ifdef MPI
        if(b_mpi) then
          call MPI_File_write_at(iunit, offset, idecs, lenstr_plus,    &
               MPI_INTEGER4, wstatus, ierrcode) 
          CHKERRQ(ierrcode)
        end if
#endif
        
        if (.not. b_mpi) then
          do i = 1, lenstr_plus
            write(iunit) idecs(i)
          end do
        end if

        return

    end subroutine dumpstring
