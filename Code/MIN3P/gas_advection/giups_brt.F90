!*****Revision Informations Automatically Generated by VisualSVN*****!
!---------------------------------------------------------------------
!> $ID:$
!> $Revision: 453 $
!> $Author: dsu $
!> $Date: 2017-02-21 19:54:05 +0100 (Tue, 21 Feb 2017) $
!> $URL: https://biot.eos.ubc.ca/svn/min3p_thcm/branches/fgerard_new/src/gas_advection/giups_brt.F90 $
!---------------------------------------------------------------------
!********************************************************************!
!c ----------------------------------------------------------------------
!c subroutine giups_brt
!c ---------------------
!c
!c choose the upstream node for weighting parameters in gas transport
!c for boundary dumy nodes
!c
!c written by: Sergi Molins, May 2, 2006 
!c
!c last modified:
!c
!c modified by: Danyang Su - March 26, 2014
!c
!c definition of variables:
!c
!c I --> on input   * arbitrary  - initialized  + entries expected
!c O --> on output  * arbitrary  - unaltered    + altered
!c                                                                    I O
!c passed:   -
!c
!c common:   
!c phys.f:   real*8:
!c           -------
!c           mdens_g(nn)        = molar density                       + - 
!c           
!c gen.f:    real*8:
!c           -------
!c           iupsg(njavs)       = upstream node                       * + 
!c           gmfrac(ng,nn)      = number of gas species               + -
!c           nn                 = number of control volumes           + -
!c
!c external: -  
!c ----------------------------------------------------------------------
      subroutine giups_brt(gpi      ,gpj      ,    &
     &                     zgi      ,zgj      ,    &
     &                     dens_i   ,dens_j   ,    &
     &                     iupsjbrt ,gacc )
    
      implicit none

      real*8 :: gpi   ,gpj
      real*8 :: zgi   ,zgj
      real*8 :: dens_i, dens_j, dens
      real*8 :: gacc
      
      character*1 :: iupsjbrt
      
      real*8 :: hi, hj
      
      if (iupsjbrt.eq.'i') then
        dens = dens_i
      else if (iupsjbrt.eq.'j') then
        dens = dens_j
      else if (iupsjbrt.eq.'a') then
        dens = ( dens_i + dens_j ) * 0.5d0
      else
        !just to avoid warning that dens may be used uninitialized
        dens = ( dens_i + dens_j ) * 0.5d0
      endif
      
      hi = gpi + dens * gacc * zgi
      hj = gpj + dens * gacc * zgj

      iupsjbrt = 'i'                           !hi >= hj
      
      if (hj.gt.hi) then                             !hj >  hi
        iupsjbrt = 'j'
      end if
      
      return
    end
