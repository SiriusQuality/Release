!*****Revision Informations Automatically Generated by VisualSVN*****!
!---------------------------------------------------------------------
!> $ID:$
!> $Revision: 453 $
!> $Author: dsu $
!> $Date: 2017-02-21 19:54:05 +0100 (Tue, 21 Feb 2017) $
!> $URL: https://biot.eos.ubc.ca/svn/min3p_thcm/branches/fgerard_new/src/min3p/diffcoff.F90 $
!---------------------------------------------------------------------
!********************************************************************!

!c ----------------------------------------------------------------------
!c real*8 function diffcoff
!c ------------------------
!c
!c compute effective diffusion coefficient
!c
!c note: tau^org = (S_p * por)^10/3 / por^2
!c               =  S_p^10/3 * por^4/3          (1)
!c
!c according to Simunek and Suarez (WRR(30)4, pp. 1115-1133):
!c
!c S_p * por * D_p^eff = tau^org * D_p          (2)
!c
!c where the factor S_p * por is considered in assembly
!c to relate pore space filled with phase p to the 
!c bulk volume of medium
!c
!c D_p^eff = tau^org * D_p / (S_p * por)        (2')
!c
!c subsitituting (1) in (2') yields:
!c
!c D_p^eff = S_p^10/3 * por^4/3 * D_p / (S_p * por)
!c         = S_p^7/3  * por^1/3 * D_p
!c         = tau^mod * D_p
!c
!c here use tau = tau^org
!c where D_p is the free diffusion coefficient in phase p
!c ----------------------------------------------------------------------
!c
!c written by:      Uli Mayer - April 28, 97
!c
!c last modified:   -
!c
!c definition of variables:
!c
!c I --> on input   * arbitrary  - initialized  + entries expected
!c O --> on output  * arbitrary  - unaltered    + altered
!c                                                                    I O
!c passed:   real*8:
!c           -------
!c           diffcoff           = effective diffusion coefficient     * +
!c           diff_p             = free diffusion coefficient in       + -
!c                                phase p
!c           sat_p              = saturation of phase p               + -
!c           por                = porosity                            + -
!c           tortuosity_corr    = .true.  -> Millington-Quirk         + -
!c                                           tortuosity correction
!c                                           for diffusion
!c                                           coefficients
!c
!c common:   -
!c
!c local:    real*8:
!c           -------
!c           r3                 = constant
!c           r4                 = constant
!c           r10                = constant
!c
!c external: -
!c ----------------------------------------------------------------------
 
      real*8 function diffcoff(diff_p,sat_p,por,tortuosity_corr,       &
                              assigned_tau,tau,type_tortuosity,        &
                              m_archie,sat_oil)
      
      implicit none

      real*8 :: diff_p, sat_p, por, tau , sat_oil
      
      real*8 :: r1, r2, r3, r4, r10

      parameter (r1 = 1.0d0, r2 = 2.0d0, r3 = 3.0d0, r4 = 4.0d0,       &
                 r10 = 10.0d0)
 
      logical tortuosity_corr,assigned_tau
      
      character(len=*) type_tortuosity
      
      real*8 m_archie 

      diffcoff = 0.0d0

      if (tortuosity_corr) then
       
         if (assigned_tau) then
            diffcoff = diff_p * tau * sat_p * por
         else   
            select case (type_tortuosity)
            case('millington')
              diffcoff = diff_p * sat_p**(r10/r3) * por**(r4/r3)*      &
                         (r1-sat_oil)**r2
            case('archie')
              !diffcoff = diff_p * sat_p * por**m_archie          ! bug, DSU 2013-2-28
              diffcoff = diff_p * sat_p * por**(m_archie + 1.0d0)
            case default
              diffcoff = diff_p * sat_p**(r10/r3) * por**(r4/r3)*      &
                         (r1-sat_oil)**r2
            end select
         end if
      
      else  
              
           diffcoff = diff_p * sat_p * por
      
      end if   
        
        
      end
