!*****Revision Informations Automatically Generated by VisualSVN*****!
!---------------------------------------------------------------------
!> $ID:$
!> $Revision: 3 $
!> $Author: dsu $
!> $Date: 2012-12-10 03:46:07 +0100 (Mon, 10 Dec 2012) $
!> $URL: https://biot.eos.ubc.ca/svn/min3p_thcm/branches/fgerard_new/src/min3p/storddfs.F90 $
!---------------------------------------------------------------------
!********************************************************************!

!c ----------------------------------------------------------------------
!c real*8 function storddfs
!c ------------------------
!c
!c compute mass storage term for fully saturated 
!c density dependent conditions
!c ----------------------------------------------------------------------
 
      real*8 function storddfs(delt1,delt2,pornew,porold,satnew,      &
     &                         satold,densnew,densold,densnewc,       &
     &                         densoldc,tdsnew,tdsold,                &
     &                         drhodc,drhodt,tempnew,tempold,         &
     &                         ispitzerdens,isnonlindens,             &
     &                         cdens1,cdens2,cdens3,cdens4)            
                                                                       
      implicit none                                                    
                                                                       
      real*8, intent(in):: delt1,delt2,satnew,satold,densnew,densold, &
     &                     pornew,porold,tdsnew,tdsold,               &
     &                     drhodc,drhodt,tempnew,tempold,             &
     &                     densnewc,densoldc,cdens1,cdens2,           &
     &                     cdens3,cdens4
     
      logical, intent(in) :: ispitzerdens,isnonlindens
     
      real*8   term1,term2,term3,term4,temp1,temp2
      
      real*8, parameter   :: r1000=1.0d3, rkelvin=273.15d0
     
!cprovi-----------------------------------------------------------
!cprovi 
!cprovi-----------------------------------------------------------        
      
      term1=densnew*satnew*(pornew-porold)/delt1 
      
      if (ispitzerdens) then 
        term2=densnewc-densoldc
      else
        term2=drhodc*(tdsnew-tdsold)
      end if
      
      term2 = pornew*satnew*term2/delt2
      
      if (isnonlindens) then
        temp1 = tempold + rkelvin
        temp2 = tempnew + rkelvin
        term3 = cdens1+r1000*temp1*                                    &
     &         (cdens2+temp1*(cdens3-temp1*cdens4))          
        term3 = cdens1+r1000*temp2*(cdens2+temp2*(cdens3-temp2*cdens4))&
     &          - term3
      else        
        term3=drhodt*(tempnew-tempold)
      end if
      
      term3=pornew*satnew*term3/delt1   
      
      term4=pornew*densnew*(satnew-satold)/delt1   
      
      storddfs = term1 + term2 + term3 + term4
      
      return
      end
      
      