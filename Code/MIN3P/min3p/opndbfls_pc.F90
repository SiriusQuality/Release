!*****Revision Informations Automatically Generated by VisualSVN*****!
!---------------------------------------------------------------------
!> $ID:$
!> $Revision: 453 $
!> $Author: dsu $
!> $Date: 2017-02-21 19:54:05 +0100 (Tue, 21 Feb 2017) $
!> $URL: https://biot.eos.ubc.ca/svn/min3p_thcm/branches/fgerard_new/src/min3p/opndbfls_pc.F90 $
!---------------------------------------------------------------------
!********************************************************************!

!c ----------------------------------------------------------------------
!c subroutine opndbfls
!c -------------------
!c
!c open database files
!c
!c written by:      Uli Mayer - February 3, 97
!c
!c last modified:   -
!c
!c definition of variables:
!c
!c I --> on input   * arbitrary  - initialized  + entries expected
!c O --> on output  * arbitrary  - unaltered    + altered
!c 
!c                                                                    I O
!c passed:   logical:
!c           --------
!c           search_database    = .true.  -> search database for      * +
!c                                           all secondary species
!c                                           possible and list in
!c                                           file prefix_o.psp
!c           character:
!c           ----------
!c           redox_master       = 'o2(aq)'                            + -
!c                                'h2(aq)'
!c                                'e-1'
!c
!c common:   
!c gen.f:    integer*4:
!c           ----------
!c           icdbs              = unit number, database for           * +
!c                                             components
!c           igdbs              = unit number, database for gases     * +
!c           imdbs              = unit number, database for minerals  * +
!c           ipsp               = unit number, list of possible       * +
!c                                             secondary species
!c           irdbs              = unit number, database for redox     * +
!c                                             couples 
!c           isdbs              = unit number, database for sorbed    * +
!c                                             species
!c           ixdbs              = unit number, database for           * +
!c                                             secondary species in
!c                                             water phase
!c           l_dbs_dir          = length of string for database       + -
!c           l_prfx             = length of prefix of I/O files       + -
!c
!c           logical:
!c           --------
!c           full_path          = .true.  -> path for database        + -
!c                                           specified in problem
!c                                           specific input file
!c
!c           character:
!c           ----------
!c           dbs_dir            = database directory                  + -
!c           drive              = drive of program installation       + -
!c           prefix             = prefix name for all I/O files       + -
!c
!c external: -
!c ----------------------------------------------------------------------
 
      subroutine opndbfls(redox_master,search_database)
 
      use parm
      use gen
      use file_unit, only : lun_get
   
      implicit none

      logical search_database
      character*12 redox_master

!c  specify unit numbers and open files
!c  database files for geochemistry

      !icdbs = 30
      !ixdbs = 31
      !imdbs = 32
      !irdbs = 33
      !igdbs = 34
      !isdbs = 35
      icdbs = lun_get()
      ixdbs = lun_get()
      imdbs = lun_get()
      irdbs = lun_get()
      igdbs = lun_get()
      isdbs = lun_get()

      if (full_path) then

      if(rank == 0 .and. b_enable_output) then    
        write(*,'(a, 1x, a)') "database:", trim(dbs_dir)
      end if 
      
      !>Note: In Linux, the path separator is /. In Windows, it is either / or \. 
      !>So just use forward slash. DSU.
        open(icdbs,file=      &
     &       dbs_dir(:l_dbs_dir)//'/comp.dbs',status='old')
        open(ixdbs,file=      &
     &       dbs_dir(:l_dbs_dir)//'/complex.dbs',status='old')
        open(imdbs,file=      &
     &       dbs_dir(:l_dbs_dir)//'/mineral.dbs',status='old')
        if (redox_master.eq.'o2(aq)') then
          open(irdbs,file=    &
     &         dbs_dir(:l_dbs_dir)//'/redox.dbs',status='old')
        elseif (redox_master.eq.'h2(aq)') then
          open(irdbs,file=    &
     &         dbs_dir(:l_dbs_dir)//'/redoxh2.dbs',status='old')
        elseif (redox_master.eq.'e-1') then
          open(irdbs,file=    &
     &         dbs_dir(:l_dbs_dir)//'/redoxe.dbs',status='old')
        end if
        open(igdbs,file=      &
     &       dbs_dir(:l_dbs_dir)//'/gases.dbs',status='old')
        open(isdbs,file=      &
     &       dbs_dir(:l_dbs_dir)//'/sorption.dbs',status='old')

      else

!cintellinux *** delete old options ***

        if (drive.eq.'u') then

          open(icdbs,file=                                            &
     &         'u:/min3p-v1.1/new/database/'//dbs_dir(:l_dbs_dir)//   &
     &         '/comp.dbs',status='old')
          open(ixdbs,file=                                            &
     &         'u:/min3p-v1.1/new/database/'//dbs_dir(:l_dbs_dir)//   &
     &         '/complex.dbs',status='old')
          open(imdbs,file=                                            &
     &         'u:/min3p-v1.1/new/database/'//dbs_dir(:l_dbs_dir)//   &
     &         '/mineral.dbs',status='old')
          if (redox_master.eq.'o2(aq)') then
            open(irdbs,file=                                          &
     &           'u:/min3p-v1.1/new/database/'//dbs_dir(:l_dbs_dir)// &
     &           '/redox.dbs',status='old')
          elseif (redox_master.eq.'h2(aq)') then
            open(irdbs,file=                                          &
     &           'u:/min3p-v1.1/new/database/'//dbs_dir(:l_dbs_dir)// &
     &           '/redoxh2.dbs',status='old')
          elseif (redox_master.eq.'e-1') then
            open(irdbs,file=                                          &
     &           'u:/min3p-v1.1/new/database/'//dbs_dir(:l_dbs_dir)// &
     &           '/redoxe.dbs',status='old')
          end if
          open(igdbs,file=                                            &
     &         'u:/min3p-v1.1/new/database/'//dbs_dir(:l_dbs_dir)//   &
     &         '/gases.dbs',status='old')
          open(isdbs,file=                                            &
     &         'u:/min3p-v1.1/new/database/'//dbs_dir(:l_dbs_dir)//   &
     &         '/sorption.dbs',status='old')

        else

          open(icdbs,file=                                            &
     &         drive//':/min3p/database/'//dbs_dir(:l_dbs_dir)//      &
     &         '/comp.dbs',status='old')
          open(ixdbs,file=                                            &
     &         drive//':/min3p/database/'//dbs_dir(:l_dbs_dir)//      &
     &         '/complex.dbs',status='old')
          open(imdbs,file=                                            &
     &         drive//':/min3p/database/'//dbs_dir(:l_dbs_dir)//      &
     &         '/mineral.dbs',status='old')
          if (redox_master.eq.'o2(aq)') then
            open(irdbs,file=                                          &
     &           drive//':/min3p/database/'//dbs_dir(:l_dbs_dir)//    &
     &           '/redox.dbs',status='old')
          elseif (redox_master.eq.'h2(aq)') then
            open(irdbs,file=                                          &
     &           drive//':/min3p/database/'//dbs_dir(:l_dbs_dir)//    &
     &           '/redoxh2.dbs',status='old')
          end if                                                      
          open(igdbs,file=                                            &
     &         drive//':/min3p/database/'//dbs_dir(:l_dbs_dir)//      &
     &         '/gases.dbs',status='old')
          open(isdbs,file=                                            &
     &         drive//':/min3p/database/'//dbs_dir(:l_dbs_dir)//      &
     &         '/sorption.dbs',status='old')

        end if

      end if

      if (search_database) then
        !ipsp = 36
        ipsp = lun_get()
        if (rank == 0 .and. b_enable_output) then
        open(ipsp,file=prefix(:l_prfx)//'_o.psp',status='unknown',     &
     &            form='formatted')
        end if
      end if


      return
      end
