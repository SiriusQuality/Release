!*****Revision Informations Automatically Generated by VisualSVN*****!
!---------------------------------------------------------------------
!> $ID:$
!> $Revision: 453 $
!> $Author: dsu $
!> $Date: 2017-02-21 19:54:05 +0100 (Tue, 21 Feb 2017) $
!> $URL: https://biot.eos.ubc.ca/svn/min3p_thcm/branches/fgerard_new/src/min3p/checkerr.F90 $
!---------------------------------------------------------------------
!********************************************************************!

      SUBROUTINE CheckErr ( ierr, label, ilog )

#ifdef PETSC
      use petsc_mpi_common, only : petsc_mpi_finalize
#endif
      use gen, only : rank
! Author: Joel VanderKwaak   May 19, 1999

      IMPLICIT NONE

      INTEGER*4 ierr,ilog
      CHARACTER(*) label

      IF (ierr == 1) THEN

        WRITE (*,10) ierr, label
!c Note: will cause write error if checkerr is called by different threads.
!c Disable this for OpenMP version. DSU

        if (rank == 0) then
          WRITE (*,10) ierr, label   
#ifndef OPENMP
          WRITE (ilog,10) ierr, label
#endif
        end if
        
#ifdef PETSC
        call petsc_mpi_finalize
#endif
        STOP

      ELSE IF (ierr > 1) THEN

        if (rank == 0) then  
          WRITE (*,20) ierr, label
#ifndef OPENMP
          WRITE (ilog,20) ierr, label
#endif
        end if

#ifdef PETSC
        call petsc_mpi_finalize
#endif
        
        STOP

      END IF

  10  FORMAT (//,'Memory allocation/deallocation error code',i6,/,a,/)
  20  FORMAT (//,'Specified array already allocated',i6,/,a,/)

      return
      end
