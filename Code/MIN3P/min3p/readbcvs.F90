!*****Revision Informations Automatically Generated by VisualSVN*****!
!---------------------------------------------------------------------
!> $ID:$
!> $Revision: 453 $
!> $Author: dsu $
!> $Date: 2017-02-21 19:54:05 +0100 (Tue, 21 Feb 2017) $
!> $URL: https://biot.eos.ubc.ca/svn/min3p_thcm/branches/fgerard_new/src/min3p/readbcvs.F90 $
!---------------------------------------------------------------------
!********************************************************************!

!c ----------------------------------------------------------------------
!c subroutine readbcvs
!c -------------------
!c
!c read time-dependent boundary data for variably-saturated flow
!c
!c written by:      Uli Mayer - April 17, 2001
!c
!c last modified:   
!c
!c definition of variables:
!c
!c I --> on input   * arbitrary  - initialized  + entries expected
!c O --> on output  * arbitrary  - unaltered    + altered
!c 
!c                                                                    I O
!c passed:    -
!c
!c common: 
!c gen.f:    real*8:
!c           -------
!c           bcond(nbz)         = boundary condition                  + +
!c                                (pressure head or flux) or
!c                                identification of seepage face
!c                                boundary type for boundary zones
!c           bcondvs(nbvs)      = boundary condition                  + +
!c                                (pressure head or flux) or
!c                                identification of seepage face
!c                                boundary type (nodal values)
!c           bcvs_read          = time to read next boundary          - + 
!c                                condition for flow    
!c           dt_bcvs            = time increment in file for          - +
!c                                time-dependent boundary condition
!c                                for variably-saturated flow
!c           time_io            = current solution time (I/O units)   + -
!c
!c           integer*4:
!c           ----------
!c           ibcvs              = unit number, data for boundary      - +
!c                                conditions for variably saturated 
!c                                flow
!c           nbz                = number of boundary zones            + -
!c
!c           logical:
!c           --------
!c           update_bcvs        = .true.  -> update boundary          * +
!c                                           condition for variably 
!c                                           saturated flow
!c
!c local:    real*8:
!c           -------
!c           dummy              = dummy variable
!c
!c           integer*4:
!c           ----------
!c           ibz                = counter (boundary zones)
!c
!c external:  -
!c ----------------------------------------------------------------------
 
      subroutine readbcvs
 
      use parm
      use gen
#ifdef PETSC
      use petsc_mpi_common, only : petsc_mpi_finalize
#endif

      implicit none
      
      real*8 :: tiny, dummy

      tiny = 1.0d-10
      
      if (time_io.gt.time_bcvs-tiny) then

        do while (time_io.gt.time_bcvs-tiny) 

!c  assign new boundary conditions for variably-saturated flow

          backspace(ibcvs)
          read(ibcvs,*,err=998,end=998) dummy, bcondvs(1),bcondvs(2)
          read(ibcvs,*,err=998,end=999) time_bcvs
          bcondvs(1) = bcondvs(1)*86400.0d0
          if(rank == 0 .and. b_enable_output) then
            write(*,*) time_bcvs, bcondvs(1),bcondvs(2)
          end if
        end do

      end if

999   return

998   continue
      if (rank == 0) then
        write(ilog,*) 'SIMULATION TERMINATED' 
        write(ilog,*) 'error reading file ', prefix(:l_prfx)//'.bcvs'
        close(ilog)
      end if
#ifdef PETSC
      call petsc_mpi_finalize
#endif
      stop

      end
