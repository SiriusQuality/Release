!*****Revision Informations Automatically Generated by VisualSVN*****!
!---------------------------------------------------------------------
!> $ID:$
!> $Revision: 453 $
!> $Author: dsu $
!> $Date: 2017-02-21 19:54:05 +0100 (Tue, 21 Feb 2017) $
!> $URL: https://biot.eos.ubc.ca/svn/min3p_thcm/branches/fgerard_new/src/min3p/porosity_flow.F90 $
!---------------------------------------------------------------------
!********************************************************************!

!c ----------------------------------------------------------------------
!c real*8 function porosity_flow(pornew,porold,delt,pwnew,pwold,stor,porstress,por0,facpormin)
!c ------------------------
!c
!c Compute the new porosity affected by flow processes
!c
!c 
!c ----------------------------------------------------------------------
 
real*8 function porosity_flow(porold,pwnew,pwold,stor,porstress,por0,facpormin)
            
implicit none
      
real*8, intent(in)    :: pwnew,pwold,porold,stor,porstress,por0,facpormin
     
real*8                :: pormin

real*8, parameter     :: small=1.0d-20, r1=1.0d0
      
pormin = facpormin * por0
      
porosity_flow = porold + stor * (pwnew-pwold) - porstress
      
if (porosity_flow<pormin) then
     porosity_flow = pormin        
elseif (porosity_flow>=r1) then
     porosity_flow = r1 - small 
end if     
      
return
end
