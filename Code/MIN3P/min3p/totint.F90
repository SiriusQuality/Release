!*****Revision Informations Automatically Generated by VisualSVN*****!
!---------------------------------------------------------------------
!> $ID:$
!> $Revision: 453 $
!> $Author: dsu $
!> $Date: 2017-02-21 19:54:05 +0100 (Tue, 21 Feb 2017) $
!> $URL: https://biot.eos.ubc.ca/svn/min3p_thcm/branches/fgerard_new/src/min3p/totint.F90 $
!---------------------------------------------------------------------
!********************************************************************!

!c ----------------------------------------------------------------------
!c subroutine totint
!c ------------------
!c compute total source/sink term towards total aqueous component 
!c concentrations due to intra-aqueous kinetic reactions
!c or derivative thereof
!c
!c written by:      Uli Mayer - April 23, 99
!c
!c last modified:   -
!c
!c definition of variables:
!c
!c I --> on input   * arbitrary  - initialized  + entries expected
!c O --> on output  * arbitrary  - unaltered    + altered
!c                                                                    I O
!c
!c passed:   idbg               = unit number - debugging file        + -
!c           totintaq(nc-1)     = total source-sink term towards      * +
!c                                total aqueous component
!c                                concentrations due to intra-aqueous
!c                                kinetic reactions or derivative
!c                                thereof
!c
!c common:
!c chem.f:   real*8:
!c           -------
!c           rateaq(naq,nthreads) 
!c                              = reaction rates of intra-aqueous     + -
!c                                kinetic reaction
!c           xnuaq(naq*nc)      = stoichiometric coefficient of       + -
!c                                components in intra-aqueous
!c                                kinetic reaction
!c
!c           integer*4:
!c           ----------
!c           iaaq(naq+1)        = row pointer array to                + -
!c                                stoichiometric coefficients in
!c                                intra-aqueous kinetic reactions
!c           jaaq(naq*nc)       = column pointer array to             + -
!c                                stoichiometric coefficients in
!c                                intra-aqueous kinetic reactions
!c           naq                = number of intra-aqueous kinetic     + -
!c                                reactions
!c           nc                 = number of components including h2o  + -
!c
!c           character:
!c           ----------
!c           namec(nc)          = component names                     + -
!c 
!c
!c local:    real*8:
!c           -------
!c           r0                 = constant
!c
!c           integer*4:
!c           ----------
!c           i                  = counter (stoichiometric
!c                                coefficients)
!c           iaq                = counter (intra-aqueous
!c                                kinetic reactions)
!c           ic                 = counter (components) 
!c           info_debug         = flag to control debugging 
!c                                information
!c           istart             = pointer (stoichiometric 
!c                                coefficients)
!c           istop              = pointer (stoichiometric
!c                                coefficients)
!c
!c external: -
!c ----------------------------------------------------------------------
  
      subroutine totint(totintaq,idbg)
 
      use parm
      use chem
#ifdef OPENMP
      use omp_lib 
#endif 
#ifdef PETSC
      use petsc_mpi_common, only : petsc_mpi_finalize 
#endif
 
      implicit none
      
      real*8 :: totintaq
      
      integer :: idbg
      
      integer :: tid, i, ic, iaq, istart, istop, info_debug

      dimension totintaq(*)

      real*8, parameter :: r0 = 0.0d0
      
#ifdef OPENMP
      tid = omp_get_thread_num() + 1
#else
      tid = 1
#endif
 
      do ic = 1,nc-1
        totintaq(ic) = r0
      end do
 
      do iaq = 1,naq
        istart = iaaq(iaq)
        istop = iaaq(iaq+1)-1
        do i = istart,istop
          ic = jaaq(i)
 
!c  skip h2o, since not a primary unknown
 
          if (namec(ic).ne.'h2o') then
            totintaq(ic) = totintaq(ic)+xnuaq(i)*rateaq(iaq,tid)
          end if
        end do
      end do

!cdbg
#ifdef DEBUG
      info_debug = 0

      if (info_debug.gt.0) then
        write(idbg,'(a)') 'returning from totint ...'
        do ic = 1,nc-1
          write(idbg,'(a72,1x,e10.3)') namec(ic),totintaq(ic)
        end do
        write(idbg,*) '----------------------------------------------'
      end if

      if (info_debug.gt.1) then
#ifdef PETSC
        call petsc_mpi_finalize
#endif
        stop
      end if
#endif
!cdbg
      return
      end
