!*****Revision Informations Automatically Generated by VisualSVN*****!
!---------------------------------------------------------------------
!> $ID:$
!> $Revision: 453 $
!> $Author: dsu $
!> $Date: 2017-02-21 19:54:05 +0100 (Tue, 21 Feb 2017) $
!> $URL: https://biot.eos.ubc.ca/svn/min3p_thcm/branches/fgerard_new/src/min3p/rhsrt.F90 $
!---------------------------------------------------------------------
!********************************************************************!

!c -----------------------------------------------------------------------
!c subroutine rhsrt
!c ----------------
!c construct entry for rhs vector (reactive transport)
!c
!c written by:      Uli Mayer - August 15, 96
!c
!c last modified:   Uli Mayer - June 2, 97
!c                  -> added oxidation/reduction terms
!c                  Uli Mayer - July 6, 98
!c                  -> added sorption reactions
!c
!c definition of variables:
!c
!c I --> on input   * arbitrary  - initialized  + entries expected
!c O --> on output  * arbitrary  - unaltered    + altered
!c                                                                    I O
!c passed:   real*8:
!c           -------
!c           astor              = storage term (noncompetitive        + -
!c                                sorption
!c           cstor              = storage term (aqueous phase)        + -
!c           gstor              = storage term (gaseous pahse)        + -
!c           totaq              = total source/sink term towards      + -
!c                                total aqueous component 
!c                                concentrations due to
!c                                intra-aqueous kinetic reactions
!c           totor              = total source/sink term towards      + -
!c                                total aqueous component 
!c                                concentrations due to 
!c                                oxidation/reduction reactions
!c           totdp              = total source/sink term towards      + -
!c                                total aqueous component 
!c                                concentrations due to mineral
!c                                dissolution-precipitation reactions
!c           totsb              = total source/sink term towards      + -
!c                                total aqueous component
!c                                concentrations due to sorbtion
!c                                reactions
!c           totsb_ion          = total source/sink term towards      + -
!c                                total aqueous component
!c                                concentrations due to sorbtion
!c                                reactions
!c                                (ion-exchange)
!c           totsb_surf         = total source/sink term towards      + -
!c                                total aqueous component
!c                                concentrations due to sorbtion
!c                                reactions
!c                                (surface-complex)
!c           totcflux           = total mass flux (aqueous phase)     + -
!c           totgflux           = total mass flux (gaseous phase)     + -
!c           totrateg           = total degassing rate                + -
!c                                (aqueous phase)
!c           b                  = entry in rhs-vector                 * +
!c
!c           integer*4:
!c           ----------
!c           naq                = number of intra-aqueous kinetic     + -
!c                                reactions
!c           ng                 = number of gases                     + -
!c           nm                 = number of minerals                  + -
!c           nr                 = number of redox couples             + -
!c           nsb                = number of sorbed species            + -
!c           nsb_ion            = number of sorbed species            + -
!c                                (ion-exchange)
!c           nsb_surf           = number of sorbed species            + -
!c                                (surface-complex)
!c
!c           logical:
!c           --------
!c           noncompetitive_sorption = logical array for activation   + -  
!c                                     of noncompetitive sorption
!c                                     reactions
!c           redox_equil        = .true.  -> equilibrium reactions    + -
!c                                           for redox couples
!c
!c           character:
!c           ----------
!c           component_type     = 'aqueous' = aqueous component       + -
!c                                'surface' = surface site
!c                                'biomass' = biomass
!c
!c common:   -
!c
!c local:    - 
!c
!c external: -
!c ----------------------------------------------------------------------
 
      subroutine rhsrt(naq,ng,nm,nr,nsb_ion,nsb_surf,astor,cstor,     &
                       gstor,totaq,totsb_ion,totsb_surf,totor,totdp,  &
                       totcflux,totgflux,totrateg,redox_equil,        &
                       noncompetitive_sorption,component_type,b)
      
      implicit none
      
      integer :: naq, ng, nm, nr, nsb_ion, nsb_surf
      real*8 :: astor, cstor, gstor, totaq, totsb_ion, totsb_surf,     &
                totor, totdp, totcflux, totgflux, totrateg, b

      logical redox_equil, noncompetitive_sorption
      character*12 component_type

!c  storage and flux terms for components

      if (component_type.eq.'aqueous') then
        b = - (cstor+totcflux)
      else
        b = - cstor
      end if

!c  storage and flux terms in gaseous phase

      if (ng.gt.0) then
        b = b - (gstor+totgflux)
      end if

!c  total source and sink terms due to degassing

      if (ng.gt.0) then
        b = b - totrateg
      end if

!c  total source and sink terms due to non-competitive 
!c  sorption reactions

    if (noncompetitive_sorption) then
      b = b - astor
    end if

!c  total source and sink terms due to sorption reactions

      if (nsb_ion.gt.0) then
        b = b - totsb_ion
      end if
      
      if (nsb_surf.gt.0) then
        b = b - totsb_surf
      end if

!c  total source/sink term due to intra-aqueous kinetic reactions

      if (naq.gt.0) then
        b = b - totaq
      end if

!c  total source/sink term due to kinetically controlled 
!c  oxidation/reduction reactions

      if (.not.redox_equil.and.nr.gt.0) then
        b = b - totor
      end if

!c  total source/sink term due to dissolution-precipitation reactions

      if (nm.gt.0) then
        b = b - totdp
      end if

      return
      end
