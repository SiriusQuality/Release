!*****Revision Informations Automatically Generated by VisualSVN*****!
!---------------------------------------------------------------------
!> $ID:$
!> $Revision: 453 $
!> $Author: dsu $
!> $Date: 2017-02-21 19:54:05 +0100 (Tue, 21 Feb 2017) $
!> $URL: https://biot.eos.ubc.ca/svn/min3p_thcm/branches/fgerard_new/src/min3p/stordd.F90 $
!---------------------------------------------------------------------
!********************************************************************!

!c ----------------------------------------------------------------------
!c real*8 function stordd
!c ------------------------
!c
!c
!c compute mass storage term for density dependent flow in
!c variably saturated conditions with fluid pressure as the
!c primary dependent variable
!c
!c assign fluid densities as a function of total component 
!c concentrations and empirical linear coefficient drho_dc
!c
!c Note: the value passed to delt2 depends on the Picard iteration
!c number.  For the initial picard iteration (iter_sia .eq. 1), the
!c previous time step length is passed as delt2.  For subsequent
!c iterations, the current time step length is passed.
!c
!c written by:      Tom Henderson - August 19, 2002
!c
!c last modified:   Tom Henderson - September 8, 2003
!c
!c definition of variables:
!c
!c I --> on input   * arbitrary  - initialized  + entries expected
!c O --> on output  * arbitrary  - unaltered    + altered
!c                                                                    I O
!c passed:   real*8:
!c           ------- 
!c           deltnew            = current time step                   + -
!c           delttds            = previous time step                  + -
!c           dens_ivol          = water density                       + - 
!c           pressnew           = fluid pressure (new time level)     + -
!c           pressold           = fluid pressure (old time level)     + -
!c           satwnew            = water saturation (new time level)   + -
!c           satwold            = water saturation (old time level)   + -
!c           stordd             = mass storage term                   * +
!c           tdsnew             = TDS (new time level)                + -  
!c           tdsold             = TDS (old time level)                + -
!c
!c           integer*4:
!c           ----------
!c           izn                = pointer (material property zone)    + -
!c
!c common: 
!c phys.f:   nzn                = number of zones                     + -
!c           por                = porosity                            + -
!c           spstor(nzn)        = specific storage coefficient        + -
!c                                wrt fluid pressure
!c
!c dens.f:   drho_dc            = density-TDS constant drho/dTDS      + -
!c           
!c
!c local:    real*8:
!c           -------
!c           densstor           = mass storage from temporal 
!c                                density variations
!c           elast              = elastic mass storage from pressure
!c                                variations
!c
!c external: -
!c ----------------------------------------------------------------------
 
      real*8 function stordd(delt1,delt2,pornew,porold,               &
     &                         satwnew,satwold,densnew,densold)
                                                                       
      implicit none                                                    
                                                                       
      real*8, intent(in) :: delt1,delt2,pornew,porold,                &
     &                        satwnew,satwold,densnew,                &
     &                      densold
     
      real*8             :: term1,term2,term3

!c  spstor(izn) converted to units of pressure in subroutine  
!c  initppdd using the following equation:  
!c  spstor(izn) = spstor(izn)/(gacc * ref_dens)
      term1 = satwnew * densnew * (pornew-porold) / delt1
      
      term2 = pornew * densnew * (satwnew-satwold) / delt1
      
      term3 = satwnew * pornew * (densnew - densold)/delt2

    stordd = term1 + term2 + term3

      return
      end
