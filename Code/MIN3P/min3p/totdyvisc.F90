!*****Revision Informations Automatically Generated by VisualSVN*****!
!---------------------------------------------------------------------
!> $ID:$
!> $Revision: 453 $
!> $Author: dsu $
!> $Date: 2017-02-21 19:54:05 +0100 (Tue, 21 Feb 2017) $
!> $URL: https://biot.eos.ubc.ca/svn/min3p_thcm/branches/fgerard_new/src/min3p/totdyvisc.F90 $
!---------------------------------------------------------------------
!********************************************************************!

!c -----------------------------------------------------------------------
!c subroutine totdyvisc
!c -------------------
!c
!c compute total aqueous component dynamic viscosity based 
!c on concentrations of free species and secondary aqueous species
!c
!c written by:      Pejman Rasouli - February 17, 2010
!c
!c last modified:   Pejman Rasouli - February 16, 2012
!c
!c definition of variables:   
!c
!c I --> on input   * arbitrary  - initialized  + entries expected
!c O --> on output  * arbitrary  - unaltered    + altered
!c                                                                   I O
!c passed:   real*8:
!c          -------
!c          cd(nc)              = concentrations of free species      + -
!c                               [moles/l water]
!c          cdx(nx)             = concentrations of secondary aqueous + -
!c                               species [moles/l water]
!c          drtinc             = increment for numerical             + -
!c                               concentrations [moles/l water]
!c
!c common:
!c chem.f:   real*8:
!c          -------
!c          xnux(nx*nc)        = stoichiometric coefficient matrix   + -
!c                               for formation of secondary aqueous
!c                               species from free species
!c
!c          integer*4:
!c          ----------
!c          iax(nx+1)          = row pointer array to                + -
!c                               stoichiometric coefficients of
!c                               free species in
!c                               secondary aqueous species
!c          jax(nx*nc)         = column pointer array to             + -
!c                               stoichiometric coefficients of
!c                               free species in secondary aqueous
!c                               species
!c          nc                = number of components including h2o  + -
!c          nx                 = number of secondary aqueous species + -
!c
!c multidiff.f90
!c         mdiff_ic_cvol(nc, njavs)= averaged diffusion coefficient of free 
!c                        aqueous species
!c         mdiff_ix_cvol(nc, njavs)= averaged diffusion coefficient of  
!c                        secondary aqueous species
!c local:    integer*4:
!c          ----------
!c          i                  = counter (stoichiometric
!c                               coefficients)
!c          ic                = counter (components)
!c          ix                 = counter (secondary aqueous species) 
!c          istart             = pointer (stoichiometric 
!c                               coefficients)
!c          iend               = pointer (stoichiometric
!c                               coefficients)
!c        totvisc(nc)        = sum of concentration * diffusion coef. 
!c                 for each species
!c external: -
!c ----------------------------------------------------------------------
  
      subroutine totdyvisc(cd,cdx,totvisc,diff_cof_ic,diff_cof_ix)
      
      use parm
      use chem
      use gen
 
      implicit none
        
      integer i, ic, istart, iend, ix
      
      integer :: info_debug
      
      real*8 :: diff_cof_ic(nc),diff_cof_ix(nx), cd(nc),cdx(nx),       &
                totvisc(nc)   
      
!c free species      

          do ic=1,nc-1
              totvisc(ic) = diff_cof_ic(ic) * cd(ic)
          end do            ! loop over free species

!c add up aqueous complexes
 
          do ix=1,nx

              istart = iax(ix)
              iend = iax(ix+1)-1
                     do i = istart,iend
                      ic = jax(i)
         
!c skip h2o, since not a primary unknown
         
                      if (namec(ic).ne.'h2o') then
                          totvisc(ic) = totvisc(ic) +        &
     &                    xnux(i)* diff_cof_ix(ix)* cdx(ix)
                      end if
                      end do
           end do            ! loop over secondary species
!cdbg
#ifdef DEBUG
      info_debug = 0
      if (info_debug.gt.0) then 
       do ic=1,nc-1     
           write(idbg,'(a,i4,a,e10.3,/)')        &
     &          'totvisc(',ic,') = ',totvisc(ic)   
       end do
           write(idbg,'(a,e10.3,/)')            &
     &          'time = ',time         
      end if
#endif
!cdbg
      


      return
      end
