!*****Revision Informations Automatically Generated by VisualSVN*****!
!---------------------------------------------------------------------
!> $ID:$
!> $Revision: 453 $
!> $Author: dsu $
!> $Date: 2017-02-21 19:54:05 +0100 (Tue, 21 Feb 2017) $
!> $URL: https://biot.eos.ubc.ca/svn/min3p_thcm/branches/fgerard_new/src/min3p/welcome_pc.F90 $
!---------------------------------------------------------------------
!********************************************************************!

!c ----------------------------------------------------------------------
!c subroutine welcome
!c ------------------
!c
!c welcome the user and read problem prefix name
!c
!c written by:      Uli Mayer - May 7, 96
!c
!c last modified:   Uli Mayer - November 28, 96
!c                  Tom Henderson - April 24, 2003
!c                  added batch run option
!c
!c definition of variables:
!c
!c I --> on input   * arbitrary  - initialized  + entries expected
!c O --> on output  * arbitrary  - unaltered    + altered
!c                                                                    I O
!c passed:   -
!c
!c common:     
!c gen.f:    real*8:
!c           -------
!c           cpuint             = cputime (intermediate) [seconds]    * +
!c
!c           integer*4:
!c           ----------
!c           l_prfx             = length of prefix of I/O files       * +
!c
!c           character:
!c           ----------
!c           prefix             = prefix name of all I/O files        * +
!c
!c local:    -
!c
!c external:  cputime   = cpu-time in seconds 
!c            getcl     = get command line (lahey intrinsic routine)
!c ----------------------------------------------------------------------
 
      subroutine welcome 
 
      use parm
      use gen
      use file_unit, only : lun_get, lun_free
      use Version, only : MajorVersionNumber, MinorVersionNumber,       &
                          GlobalRevisionNumber, BuildVersionNumber,     &
                          BuildDate
      use solver, only : solver_get_args
#ifdef PETSC
      use petsc_mpi_common, only : petsc_mpi_barrier
#endif

      implicit none
      
      integer :: iunit
      
      real*8 :: cputime
      
      logical :: batchrun

      external :: cputime

!c set batch toggle variable here **************
      batchrun = .false.

      if (batchrun) then
      prefix = 'kmno4'
      l_prfx=index(prefix,' ')-1
      else

!c  welcome the user 
 
!        write(*,2)
      if(rank == 0) then
        write(*,3) trim(MajorVersionNumber), trim(MinorVersionNumber),     &
                   trim(GlobalRevisionNumber), trim(BuildVersionNumber),   &
                   BuildDate(1:10)
      end if

!2       format (/,'    ------------------------------------------------'   &
!     &          /,'          M     M  I  N     N  333333  PPPPPP       '   &
!     &          /,'          MM   MM  I  NN    N       3  P    P       '   &
!     &          /,'          M M M M  I  N N   N       3  P    P       '   &
!     &          /,'          M  M  M  I  N  N  N    3333  PPPPPP       '   &
!     &          /,'          M     M  I  N   N N       3  P            '   &
!     &          /,'          M     M  I  N    NN       3  P            '   &
!     &          /,'          M     M  I  N     N  333333  P            '   &
!     &         //,'                     Version 1.1'                       &
!     &         //,'          A Numerical Model for the Analysis'           &
!     &          /,'                       of the'                          &
!     &          /,'                Geochemical Evolution'                  &
!     &          /,'                         of'                            &
!     &          /,'                   Variable-Density'                    &
!     &          /,'              Mineral-Water-Gas-Systems'                &
!     &         //,'                  (c) 2000 U. Mayer'                    &
!     &         //,'              Pitzer equations are included'            &
!     &          /,'   -------------------------------------------'//)
        
3    format (/,'    ------------------------------------------------'   &
     &          /,'          M     M  I  N     N  333333  PPPPPP       '   &
     &          /,'          MM   MM  I  NN    N       3  P    P       '   &
     &          /,'          M M M M  I  N N   N       3  P    P       '   &
     &          /,'          M  M  M  I  N  N  N    3333  PPPPPP       '   &
     &          /,'          M     M  I  N   N N       3  P            '   &
     &          /,'          M     M  I  N    NN       3  P            '   &
     &          /,'          M     M  I  N     N  333333  P            '   &
     &          //,'                   Version ', 3(a,"."),a               &
     &          //,'                Build Date: ', a                       &
     &          //,'          A Numerical Model for the Analysis'          &
     &          /,'                       of the'                          &
     &          /,'                Geochemical Evolution'                  &
     &          /,'                         of'                            &
     &          /,'                   Variable-Density'                    &
     &          /,'              Mineral-Water-Gas-Systems'                &
     &         //,'                  (c) 2000 U. Mayer'                    &
     &         //,'              Pitzer equations are included'            &
     &          /,'   -------------------------------------------'/)       

!cprovi     &        ///,'    now provide prefix of problem filename ...'//)
!cprovi---------------------------------------------------------------------
!cprovi Read the prefix from a root file
!cprovi It was added by Sergio Andres Bea 
!cprovi First, try to find the file root.dat and read the prefix from it
!cprovi If this file is not found, then request the prefix from screen 
!cprovi---------------------------------------------------------------------
         !iunit = 1
         iunit = lun_get()
         open(iunit,file='root.dat',err=10,status='old')
         read(iunit,*) prefix
         close(iunit)
         call lun_free(iunit)
         goto 20
10       continue 
         if(rank == 0) then    
             write(*,*) '    now provide prefix of problem filename ...'
         end if
!cprovi---------------------------------------------------------------------
!c  read problem prefix name and define prefix length
 
!clahey call getcl(prefix)               !get prefix from batch file (lahey)   
!cdsu use the function getarg to read in arguments, making the program able to start from command line
!cdsu format: min3p.exe inputfile -input_option1 option1 -input_option2 option2
        call solver_get_args
        
#ifdef PETSC
        call petsc_mpi_barrier
#endif
            
!clahey if (prefix(1:1).eq.' ') then
!clahey   read(*,'(a12)') prefix          !get prefix from command line
!clahey end if
!cintellinux *** get prefix from command line ***
   20   continue 
        l_prfx=index(prefix,' ')-1
        if(l_prfx.eq.-1.or.l_prfx.gt.256)then   !previous length of prefix is 72, dsu
           l_prfx=256                            !previous length of prefix is 72, dsu
        endif

      endif !(batchrun)

!c  assign initial cputime

      cpuint = cputime()

      return
      end
