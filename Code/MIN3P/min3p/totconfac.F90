!*****Revision Informations Automatically Generated by VisualSVN*****!
!---------------------------------------------------------------------
!> $ID:$
!> $Revision: 221 $
!> $Author: dsu $
!> $Date: 2014-08-05 23:29:49 +0200 (Tue, 05 Aug 2014) $
!> $URL: https://biot.eos.ubc.ca/svn/min3p_thcm/branches/fgerard_new/src/min3p/totconfac.F90 $
!---------------------------------------------------------------------
!********************************************************************!

!c -----------------------------------------------------------------------
!c subroutine totconcfac
!c -------------------
!c
!c compute total aqueous component concentrations times porosity 
!c correction factors for all primary and secondary species based 
!c on concentrations of free species and secondary aqueous species
!c This is to prepare for the storage term calculation for the 
!c hybrid multicomponent diffusion model.
!c
!c written by:      Mingliang Xie - April 3, 2014
!c
!c last modified:   
!c
!c definition of variables:
!c
!c I --> on input   * arbitrary  - initialized  + entries expected
!c O --> on output  * arbitrary  - unaltered    + altered
!c                                                                    I O
!c passed:   real*8:
!c           -------
!c           c(nc)              = concentrations of free species      + -
!c                                [moles/l water]
!c           cx(nx)             = concentrations of secondary aqueous + -
!c                                species [moles/l water]
!c           totc(nc-1)         = total aqueous component             * +
!c                                concentrations [moles/l water]
!c           f_epor_ps(nc,nzn)  = porosity correction factor of       + -
!c                                primary aqueous species [-]
!c           f_epor_ss(nx,nzn)  = porosity correction factor of       + -
!c                                secondary aqueous species [-]

!c
!c common:
!c chem.f:   real*8:
!c           -------
!c           xnux(nx*nc)        = stoichiometric coefficient matrix   + -
!c                                for formation of secondary aqueous
!c                                species from free species
!c
!c           integer*4:
!c           ----------
!c           iax(nx+1)          = row pointer array to                + -
!c                                stoichiometric coefficients of
!c                                free species in
!c                                secondary aqueous species
!c           jax(nx*nc)         = column pointer array to             + -
!c                                stoichiometric coefficients of
!c                                free species in secondary aqueous
!c                                species
!c           nc                 = number of components including h2o  + -
!c           nx                 = number of secondary aqueous species + -
!c
!c local:    integer*4:
!c           ----------
!c           i                  = counter (stoichiometric
!c                                coefficients)
!c           ic                 = counter (components)
!c           ix                 = counter (secondary aqueous species) 
!c           istart             = pointer (stoichiometric 
!c                                coefficients)
!c           iend               = pointer (stoichiometric
!c                                coefficients)
!c
!c external: -
!c ----------------------------------------------------------------------
  
      subroutine totconcfac(c,cx,totcf,izn)
 
      use parm
      use chem
      use gen, only : f_epor_ps, f_epor_ss
 
      implicit none
      
      real*8 :: c, cx, totcf

      dimension c(*),cx(*),totcf(*)
      integer izn
      
      integer :: i, ic, ix, istart, iend
 
!c  free species
 
      do ic=1,nc-1
        totcf(ic) = c(ic)*f_epor_ps(ic,izn)
      end do

!c  add up aqueous complexes
 
      do ix=1,nx
        istart = iax(ix)
        iend = iax(ix+1)-1
        do i = istart,iend
          ic = jax(i)
 
!c  skip h2o, since not a primary unknown
 
          if (namec(ic).ne.'h2o') then
            totcf(ic) = totcf(ic)+xnux(i)*cx(ix)*f_epor_ss(ix,izn)
          end if
        end do
      end do
 
      return
      end
