!*****Revision Informations Automatically Generated by VisualSVN*****!
!---------------------------------------------------------------------
!> $ID:$
!> $Revision: 453 $
!> $Author: dsu $
!> $Date: 2017-02-21 19:54:05 +0100 (Tue, 21 Feb 2017) $
!> $URL: https://biot.eos.ubc.ca/svn/min3p_thcm/branches/fgerard_new/src/min3p/mem_nc.F90 $
!---------------------------------------------------------------------
!********************************************************************!

!c -----------------------------------------------------------------------
!c subroutine mem_nc
!c -----------------
!c
!c allocate memory for one-dimensional arrays of size n and nc
!c
!c written by:      Uli Mayer - Januray 6, 2000
!c
!c last modified:   -
!c
!c definition of variables:
!c
!c I --> on input   * arbitrary  - initialized  + entries expected
!c O --> on output  * arbitrary  - unaltered    + altered
!c                                                                    I O
!c passed:   -
!c
!c common:
!c gen.f:    real*8:
!c           -------
!c           delta_c(n)         = actual update in log cycles         * +
!c           delta_c_max(n)     = maximum update in log cycles        * +
!c
!c           integer:
!c           --------
!c           ilog               = unit number, logbook file           + -
!c           n                  = number of components excluding h2o  + -
!c                                equals number of unknowns per
!c                                control volume
!c
!c chem.f:   real*8:
!c           -------
!c           actv(nc)           = activities of components as species * +
!c                                in solution - new time level
!c           alkfacc(nc)        = alkalinity factors for components   * +
!c           ccnew(nc)          = concentrations of components as
!c                                species in solution
!c                                - new time level [moles/l water]
!c           ccold(nc)          = concentrations of components as     * +
!c                                species in solution
!c                                - old time level [moles/l water]
!c           chargec(nc)        = charge of components as species     * +
!c                                in solution
!c           dhac(nc)           = debye-huckel a for components as    * +
!c                                species in solution
!c           dhbc(nc)           = debye-huckel b for components as    * +
!c                                species in solution
!c           gfwc(nc)           = gram formula weight of components   * +
!c           phguess            = guess for pH                        * +
!c           sion1(nthreads)    = ionic strength (local chemistry)    * +
!c           totcmin(nc-1)      = minimum total aqueous component     * +
!c                                concentration in solution domain
!c           totcn(nc-1,nthreads)
!c                              = total aqueous component             * +
!c                                concentrations
!c                                - new time level [moles/l water]
!c           totco(nc-1,nthreads)
!c                              = total aqueous component            * +
!c                                concentrations
!c                                - old time level [moles/l water]
!c           totcinit(nc-1)     = total aqueous component            * +
!c                                concentrations
!c                                - initial concentrations
!c                                [moles/l water]
!c           dtotaq(nc-1,nthreads)       
!c                              = derivative of total source-sink     * +
!c                                term towards total aqueous component
!c                                concentrations due to intra-aqueous
!c                                kinetic reactions
!c           totaq(nc-1,nthreads)
!c                              = total source-sink term towards      * +
!c                                total aqueous component
!c                                concentrations due to intra-aqueous
!c                                kinetic reactions
!c           dtotor(nc-1)       = derivative of total source/sink     * +
!c                                term towards total aqueous
!c                                component concentrations due to
!c                                oxidation-reduction reactions
!c                                [moles/(l bulk*day)]
!c           totor(nc-1)        = total source/sink term towards      * +
!c                                total aqueous component
!c                                concentrations due to
!c                                oxidation-reduction reactions
!c                                [moles/(l bulk*day)]
!c           totgn(nc-1,nthreads)
!c                              = total gaseous component             * +
!c                                concentrations
!c                                - new time level [moles/l air]
!c           totgo(nc-1)        = total gaseous component             * +
!c                                concentrations
!c                                - old time level [moles/l air]
!c           totrateg(nc-1)     = total rate for removal of aqueous   * +
!c                                components due to degassing
!c                                [mol L^-1 s^-1]
!c           totcsn(nc-1)       = total sorbed component              * +
!c                                concentrations
!c                                - new time level [moles/l bulk]
!c           totcsn_ion(nc-1,nthreads) 
!c                              = total sorbed component              + -
!c                                concentrations
!c                                (ion-exchange)
!c           totcsn_surf(nc-1,nthreads)  
!c                              = total sorbed component              + -
!c                                concentrations
!c                                - new time level [moles/l bulk]
!c                                (surface-complex)
!c           totcso(nc-1)       = total sorbed component              * +
!c                                concentrations
!c                                - old time level [moles/l bulk]
!c           totcso_ion(nc-1)   = total sorbed component              * +
!c                                concentrations
!c                                - old time level [moles/l bulk]
!c                                (ion-exchange)
!c           totcso_surf(nc-1)  = total sorbed component              * +
!c                                concentrations
!c                                - old time level [moles/l bulk]
!c                                (surface-complex)
!c           cinc(nc,nthreads)  = incremented concentrations of       * +
!c                                components as species in solution
!c                                [moles/l h2o]
!c           dtotc(n,nthreads)  = derivatives of total aqueous        * +
!c                                component concentrations
!c                                [moles/l h2o]
!c           dtotcf(n,nthreads) = derivatives of total aqueous
!c                                component concentrations
!c                                times porosity correstion 
!c                                factors for hMCD model [moles/l h2o]
!c           dtotdp(n,nthreads) = derivatives of total source/sink    * +
!c                                term towards total aqueous
!c                                component concentrations due to
!c                                mineral dissolution-precipitation
!c                                reactions
!c                                [moles/(l bulk*day)]
!c           dtotg(n)           = derivatives of total gaseous        * +
!c                                component concentrations
!c                                [moles/l air]
!c           dtotsb(n)          = derivatives of total source/sink    * +
!c                                term towards total aqueous
!c                                component concentrations due to
!c                                sorption reactions
!c                                [moles/(l bulk*day)]
!c           dtotsb_ion(n,nthreads)      
!c                              = derivatives of total source/sink    * +
!c                                term towards total aqueous
!c                                component concentrations due to
!c                                sorption reactions
!c                                [moles/(l bulk*day)]
!c                                (ion-exchange)
!c           dtotsb_surf(n,nthreads)     
!c                              = derivatives of total source/sink    * +
!c                                term towards total aqueous
!c                                component concentrations due to
!c                                sorption reactions
!c                                [moles/(l bulk*day)]
!c                                (surface-complex)
!c           dtota(n)           = derivatives of total sorbed         * +
!c                                component concentrations
!c                                (non-competitive sorption)
!c                                [moles/l bulk]
!c           totcinc(n,nthreads)= total aqueous component             * +
!c                                concentrations
!c                                - new time level - incremented
!c                                [moles/l h2o]
!c           totdp(n,nthreads)  = total source/sink term towards      * +
!c                                total aqueous component
!c                                concentrations due to mineral
!c                                dissolution-precipitation
!c                                reactions [moles/(l bulk*day)]
!c           totsb(n)           = total source/sink term towards      * +
!c                                total aqueous component
!c                                concentrations due to sorption
!c                                reactions [moles/(l bulk*day)]
!c           totsb_ion(n)       = total source/sink term towards      * +
!c                                total aqueous component
!c                                concentrations due to sorption
!c                                reactions [moles/(l bulk*day)]
!c                                (ion-exchange)
!c           totsb_surf(n)      = total source/sink term towards      * +
!c                                total aqueous component
!c                                concentrations due to sorption
!c                                reactions [moles/(l bulk*day)]
!c                                (surface-complex)
!c           alc(n,n,nthreads)  = Jacobian matrix                     * +
!c           blc(n,nthreads)    = rhs-vector                          * +
!c
!c           integer:
!c           --------
!c           iais(nc)           = row pointer array for compressed    * +
!c                                storage of surface site data
!c           l_namec(nc)        = length of component names           * +
!c           nc                 = number of components including h2o  + -
!c           ncorder(nc)        = ordering array for components       * +
!c                                ncorder(old order) = new order
!c
!c           character:
!c           ----------
!c           component_type(nc) = 'aqueous' = aqueous component       * +
!c                                'surface' = surface site
!c                                'biomass' = biomass
!c           ctype(nc-1)        = 'charge' = correct total aqueous    * +
!c                                           component concentration
!c                                           for specified component
!c                                           to satisfy charge balance
!c                                'fixed'  = compute total aqueous
!c                                           component concentrations
!c                                           based on fixed activities
!c                                           of components as species
!c                                           in solution
!c                                'free'   = compute concentrations
!c                                           of components as species
!c                                           in solution based on
!c                                           specified total aqueous
!c                                           component concentrations
!c                                'ph'    =  pH specified for 'h+1'
!c           ctype_init(nc-1)   = 'charge' = correct total aqueous    * +
!c                                           component concentration
!c                                           for specified component
!c                                           to satisfy charge balance
!c                                'fixed'  = compute total aqueous
!c                                           component concentrations
!c                                           based on fixed activities
!c                                           of components as species
!c                                           in solution
!c                                'free'   = compute concentrations
!c                                           of components as species
!c                                           in solution based on
!c                                           specified total aqueous
!c                                           component concentrations
!c                                'ph'    =  pH specified for 'h+1'
!c           isotherm_type(nc)  = definition of sorption isotherm     * +
!c                                'none' = no sorption
!c                                'linear' = linear adsorption
!c                                'freundlich' = Freundlich isotherm
!c                                'langmuir' = Langmuir isotherm
!c           namec(nc)          = component names                     * +
!c
!c local:    integer:
!c           --------
!c           ierr               = 0 -> memory allocation successful
!c
!c external: checkerr  = check for error during memory allocation
!c
!c---------------------------------------------------------------------- 
!c WARNING
!c---------------------------------------------------------------------- 
!c All allocated variables are initialized to some value. This depends  
!c of its type:
!c 
!c real*8      => 0.0d0
!c integer     => 0 
!c character   => ' '    
!c logical     => .false. 
!c 
!c Sergio Andres Bea Jofre (2009)
!c
!c ----------------------------------------------------------------------
  
      subroutine mem_nc
 
      use parm
      use gen
      use chem
      
      implicit none
      
      integer :: ierr
 
      external checkerr

!c  control parameters - local chemistry

      allocate (ncorder(nc), stat = ierr)
      ncorder=0 
      call checkerr(ierr,'ncorder',ilog)

      allocate (component_type(nc), stat = ierr)
      component_type=' ' 
      call checkerr(ierr,'component_type',ilog)

      allocate (ctype(nc-1), stat = ierr)
      ctype=' ' 
      call checkerr(ierr,'ctype',ilog)

      allocate (ctype_init(nc-1), stat = ierr)
      ctype_init=' ' 
      call checkerr(ierr,'ctype_init',ilog)

!c  main variables - aqueous species

      allocate (actv(nc), stat = ierr)
      actv=0.0d0
      call checkerr(ierr,'actv',ilog)

      allocate (alkfacc(nc), stat = ierr)
      alkfacc=0.0d0
      call checkerr(ierr,'alkfacc',ilog)

      allocate (totcn(nc-1,nthreads), stat = ierr)
      totcn=0.0d0
      call checkerr(ierr,'totcn',ilog)

      allocate (totcmin(nc-1), stat = ierr)
      totcmin=0.0d0
      call checkerr(ierr,'totcmin',ilog)

      allocate (totcmin_gbl(nc-1), stat = ierr)
      totcmin_gbl=0.0d0
      call checkerr(ierr,'totcmin_gbl',ilog)

      allocate (totco(nc-1,nthreads), stat = ierr)
      totco=0.0d0
      call checkerr(ierr,'totco',ilog)

      allocate (totcinit(nc-1), stat = ierr)
      totcinit=0.0d0
      call checkerr(ierr,'totcinit',ilog)

      allocate (ccnew(nc), stat = ierr)
      ccnew=0.0d0
      call checkerr(ierr,'ccnew',ilog)

      allocate (ccold(nc), stat = ierr)
      ccold=0.0d0
      call checkerr(ierr,'ccold',ilog)

      allocate (chargec(nc), stat = ierr)
      chargec=0.0d0
      call checkerr(ierr,'chargec',ilog)

      allocate (gfwc(nc), stat = ierr)
      gfwc=0.0d0
      call checkerr(ierr,'gfwc',ilog)

      allocate (dhac(nc), stat = ierr)
      dhac=0.0d0
      call checkerr(ierr,'dhac',ilog)

      allocate (dhbc(nc), stat = ierr)
      dhbc=0.0d0
      call checkerr(ierr,'dhbc',ilog)

      allocate (l_namec(nc), stat = ierr)
      l_namec=0  
      call checkerr(ierr,'l_namec',ilog)

      allocate (namec(nc), stat = ierr)
      namec=' ' 
      call checkerr(ierr,'namec',ilog)

      allocate (dtotviscnew(nc,nthreads), stat = ierr)        !MCD
      dtotviscnew=0.0d0
      call checkerr(ierr,'dtotviscnew',ilog)

      allocate (delecmigrationnew(nc,nthreads), stat = ierr)   !MCD
      delecmigrationnew=0.0d0
      call checkerr(ierr,'delecmigrationnew',ilog)
      
!c  main variables - intra-aqueous kinetic reactions

      allocate (dtotaq(nc-1,nthreads), stat = ierr)
      dtotaq=0.0d0
      call checkerr(ierr,'dtotaq',ilog)

      allocate (totaq(nc-1,nthreads), stat = ierr)
      totaq=0.0d0
      call checkerr(ierr,'totaq',ilog)

!c  main variables - oxidation-reduction

      allocate (dtotor(nc-1), stat = ierr)
      dtotor=0.0d0
      call checkerr(ierr,'dtotor',ilog)

      allocate (totor(nc-1), stat = ierr)
      totor=0.0d0
      call checkerr(ierr,'totor',ilog)

!c  main variables - gases

      allocate (totgn(nc-1,nthreads), stat = ierr)
      totgn=0.0d0
      call checkerr(ierr,'totgn',ilog)

      allocate (totgo(nc-1), stat = ierr)
      totgo=0.0d0
      call checkerr(ierr,'totgo',ilog)

      allocate (totrateg(nc-1), stat = ierr)
      totrateg=0.0d0
      call checkerr(ierr,'totrateg',ilog)

!c  main variables - sorbed species

      !allocate (totcsn(nc-1), stat = ierr)
      !totcsn=0.0d0
      !call checkerr(ierr,'totcsn',ilog)
      
      allocate (totcsn_ion(nc-1,nthreads), stat = ierr)
      totcsn_ion=0.0d0
      call checkerr(ierr,'totcsn_ion',ilog)
      
      allocate (totcsn_surf(nc-1,nthreads), stat = ierr)
      totcsn_surf=0.0d0
      call checkerr(ierr,'totcsn_surf',ilog)

      !allocate (totcso(nc-1), stat = ierr)
      !totcso=0.0d0
      !call checkerr(ierr,'totcso',ilog)
      
      allocate (totcso_ion(nc-1), stat = ierr)
      totcso_ion=0.0d0
      call checkerr(ierr,'totcso_ion',ilog)
      
      allocate (totcso_surf(nc-1), stat = ierr)
      totcso_surf=0.0d0
      call checkerr(ierr,'totcso_surf',ilog)

      allocate (iais(nc), stat = ierr)
      iais=0 
      call checkerr(ierr,'iais',ilog)

      allocate (isotherm_type(nc), stat = ierr)
      isotherm_type=' ' 
      call checkerr(ierr,'isotherm_type',ilog) 

!c  time step control - global system

      allocate (delta_c(n), stat = ierr)
      delta_c=0.0d0
      call checkerr(ierr,'delta_c',ilog)

      allocate (delta_c_max(n), stat = ierr)
      delta_c_max=0.0d0
      call checkerr(ierr,'delta_c_max',ilog)

!c  newton iteration

      allocate (cinc(nc,nthreads), stat = ierr)
      cinc=0.0d0
      call checkerr(ierr,'cinc',ilog)

      allocate (dtota(n), stat = ierr)
      dtota=0.0d0
      call checkerr(ierr,'dtota',ilog)
    
      allocate (dtotc(n,nthreads), stat = ierr)
      dtotc=0.0d0
      call checkerr(ierr,'dtotc',ilog)
      if (hmulti_diff) then
        allocate (dtotcf(n,nthreads), stat = ierr)
      dtotcf=0.0d0
        call checkerr(ierr,'dtotcf',ilog)
      end if

      allocate (dtotg(n), stat = ierr)
      dtotg=0.0d0
      call checkerr(ierr,'dtotg',ilog)

      !allocate (dtotsb(n), stat = ierr)
      !dtotsb=0.0d0
      !call checkerr(ierr,'dtotsb',ilog)
      
      allocate (dtotsb_ion(n,nthreads), stat = ierr)
      dtotsb_ion=0.0d0
      call checkerr(ierr,'dtotsb_ion',ilog)
      
      allocate (dtotsb_surf(n,nthreads), stat = ierr)
      dtotsb_surf=0.0d0
      call checkerr(ierr,'dtotsb_surf',ilog)

      allocate (totdp(n,nthreads), stat = ierr)
      totdp=0.0d0
      call checkerr(ierr,'totdp',ilog)

      allocate (dtotdp(n,nthreads), stat = ierr)
      dtotdp=0.0d0
      call checkerr(ierr,'dtotdp',ilog)

      !allocate (totsb(n), stat = ierr)
      !totsb=0.0d0
      !call checkerr(ierr,'totsb',ilog)
      
      allocate (totsb_ion(n), stat = ierr)
      totsb_ion=0.0d0
      call checkerr(ierr,'totsb_ion',ilog)
      
      allocate (totsb_surf(n), stat = ierr)
      totsb_surf=0.0d0
      call checkerr(ierr,'totsb_surf',ilog)

      allocate (totcinc(n,nthreads), stat = ierr)
      totcinc=0.0d0
      call checkerr(ierr,'totcinc',ilog)

!c  work arrays - local chemistry

      allocate (alc(n,n,nthreads), stat = ierr)
      alc=0.0d0
      call checkerr(ierr,'alc',ilog)

      allocate (blc(n,nthreads), stat = ierr)
      blc=0.0d0
      call checkerr(ierr,'blc',ilog)

!c  non-competitive sorption

      allocate (distcoff_lc(nc), stat = ierr)
      distcoff_lc=0.0d0
      call checkerr(ierr,'distcoff_lc',ilog)
    
      allocate (totan(nc,nthreads), stat = ierr)
      totan=0.0d0 
      call checkerr(ierr,'totan',ilog)
     
      allocate (totao(nc), stat = ierr)
      totao=0.0d0 
      call checkerr(ierr,'totao',ilog)
    
      allocate (l_nameanc(nc), stat = ierr)
      l_nameanc=0 
      call checkerr(ierr,'l_nameanc',ilog)
     
      allocate (nameanc(nc), stat = ierr)
      nameanc=' ' 
      call checkerr(ierr,'nameanc',ilog)

      return
      end
