!*****Revision Informations Automatically Generated by VisualSVN*****!
!---------------------------------------------------------------------
!> $ID:$
!> $Revision: 453 $
!> $Author: dsu $
!> $Date: 2017-02-21 19:54:05 +0100 (Tue, 21 Feb 2017) $
!> $URL: https://biot.eos.ubc.ca/svn/min3p_thcm/branches/fgerard_new/src/min3p/initpprt.F90 $
!---------------------------------------------------------------------
!********************************************************************!

!c ----------------------------------------------------------------------
!c subroutine initpprt
!c -------------------
!c
!c physical parameters for reactive transport
!c
!c written by:      Uli Mayer - May 13, 96
!c
!c last modified:   Uli Mayer - November 25, 96
!c
!c definition of variables:
!c
!c I --> on input   * arbitrary  - initialized  + entries expected
!c O --> on output  * arbitrary  - unaltered    + altered
!c                                                                    I O
!c passed:   -
!c
!c common: 
!c gen.f:    real*8:
!c           -------
!c           sec_per_days       = conversion factor from SI input     + -
!c                                units for physico-chemical
!c                                parameters to internal time units
!c
!c
!c           integer*4:
!c           ----------
!c           icnv               = unit number, type conversion and    + -
!c                                temporary storage      
!c           idat               = unit number, run specific input     + -
!c                                             file
!c           igen               = unit number, generic output file    + -
!c           ilog               = unit number, log book               + -
!c           itmp               = unit number, temporary storage      + -
!c           l_zone_name        = length of zone name                 * +
!c           nvx                = number of control volumes in        + -
!c                                x-direction
!c           nvy                = number of control volumes in        + -
!c                                y-direction
!c           nvz                = number of control volumes in        + -
!c                                z-direction
!c
!c
!c           logical:
!c           --------
!c           fully_saturated    = .true.  -> saturated conditions     + -
!c 
!c           character:
!c           ----------
!c           section_header     = section header                      * +
!c           zone_name          = name of zone                        * +
!c
!c phys.f:   real*8:
!c           -------
!c           disx(nzn)          = longitudinal dispersivity           * +
!c           disy(nzn)          = transverse horizontal dispersivity  * +
!c           disz(nzn)          = transverse vertical dispersivity    * +
!c           diff_a(nzn)        = diffusion coefficient in aqueous    * +
!c                                phase (equal for all species)
!c           diff_g(nzn)        = diffusion coefficient in gaseous    * +
!c                                phase (equal for all species)
!c           diff_bin_g(ng,ng)  = binary gas diffusion coefficients   * +
!c           visc_comp_g(ng)    = viscosity of gas species            * +
!c           dens_gcnst         = density of gas mixture (constant)   * +    
!c           visc_gcnst         = viscosity of gas mixture (constant) * +
!c
!c           integer*4:
!c           ----------
!c           mprop_name(nzn)    = name of material property zone      + -
!c           nzn                = number of material property zones   + -
!c           logical:
!c           --------
!c           blanc_diff_g       = .true.  -> LeBlanc's approx to      * +
!c                                           compute diff coeff 
!c                                           (Fick's law)
!c
!c dgml.f    logical:
!c           --------
!c           dgm                = .true.  -> use DGM to compute       * +
!c                                           diffusive fluxes 
!c           maxwell            = .true.  -> use Stefan-Maxwell       * +
!c                                           to compute diff fluxes 
!c           equimolar          = .true.  -> force equimolar diffus   * +
!c                                           in Stefan-Maxwell
!c           update_dens_g      = .true.  -> compute gas density      * +
!c                                           as function of concs  
!c           variable_visc_g    = .true.  -> compute gas viscosity    * +
!c                                           as function of concs  
!c
!c
!c local:    real*8:
!c           -------
!c           r0                 = constant
!c           epsil(ng)          = lennard-jones potential epsilon
!c           sigma(ng)          = lennard-jones potential sigma
!c
!c           integer*4:
!c           ----------
!c           izn                = counter
!c           l_string           = length of text string
!c
!c           logical:
!c           --------
!c           found_section      = .true.  -> section header was
!c                                           found in input file
!c           found_subsection   = .true.  -> subsection header was
!c                                           found in input file
!c
!c           character:
!c           ----------
!c           subsection         = name of subsection in input file
!c
!c external: findstrg  = find text string in file
!c           readbloc  = read section of input file and write to 
!c                       temporary file
!c ----------------------------------------------------------------------
 
      subroutine initpprt
 
      use parm
      use gen
      use phys
      use chem
      use dgml
#ifdef PETSC
      use petsc_mpi_common, only : petsc_mpi_finalize
#endif
 
      implicit none
      
      integer :: i, ic, ig, ix, izn, jg, l_string

      external findstrg, readbloc, findstrginzone

      logical found_section, found_subsection
      character*72 subsection
      
      character*20 :: equi
      real*8 :: sigma(ng), epsil(ng)

      real*8, parameter :: r0 = 0.0d0

!c  read physical parameters for reactive transport and write to 
!c  temporary file
   
      section_header = 'physical parameters - reactive transport'
      call readbloc (idat,itmp,section_header,found_section,.true.)

!c  define length of section header

      l_string = index(section_header,'  ')-1
      if (l_string.eq.-1.or.l_string.gt.72) then
         l_string=72
      end if

!c  terminate program if section header not found

      if (.not.found_section) then
        if (rank == 0) then
          write(ilog,*) 'error reading input file'
          write(ilog,*) 'section "',section_header(:l_string),'" missing'
          close(ilog)
        end if
#ifdef PETSC
        call petsc_mpi_finalize
#endif
        stop
 
      elseif (found_section) then

!c  write section header to generic output file
        if (b_enable_output .and. b_enable_output_gen) then
          write(igen,'(/72a)')('-',i=1,72)
          write(igen,'(a)') section_header(:l_string)
          write(igen,'(72a/)')('-',i=1,72)
        end if

!c  read diffusion coefficients - identical for all material 
!c  property zones

        subsection = 'diffusion coefficients'

        call findstrg(subsection,itmp,found_subsection)

        if (found_subsection) then

          read(itmp,*,err=999,end=999) diff_a
          if (.not.fully_saturated) then
            read(itmp,*,err=999,end=999) diff_g
          end if

        elseif (.not.found_subsection) then

          if (rank == 0) then  
            l_string = index(subsection,'  ')-1
            if (l_string.eq.-1.or.l_string.gt.72) then
               l_string=72
            end if          
            write(ilog,*) 'error reading input file'
            write(ilog,*) 'subsection "',subsection(:l_string),     &
     &                 '" missing'
            close(ilog)
          end if
#ifdef PETSC
          call petsc_mpi_finalize
#endif
          stop

        end if

!c  write diffusion coefficients to generic output file
        if (b_enable_output .and. b_enable_output_gen) then
          write(igen,'(a,1pe10.3)')                                 &
     &    'free diffusion coefficient in aqueous phase     = ',     &
     &     diff_a
          if (.not.fully_saturated) then
            write(igen,'(a,1pe10.3/)')                              &
     &      'free diffusion coefficient in gaseous phase     = ',   &
     &       diff_g
          end if
        end if
 
!c  conversion of time units for computation in days

        diff_a = diff_a * sec_per_days
        if (.not.fully_saturated) then
          diff_g = diff_g * sec_per_days
        end if
        
!c new - sergi
	    subsection = 'binary gas diffusion coefficients'

        call findstrg(subsection,itmp,found_subsection)

        if (found_subsection) then

	      blanc_diff_g = .true.

          do ig = 1,ng-1
            do jg = ig + 1,ng
		      read(itmp,*,err=999,end=999) diff_bin_g(ig,jg)
              diff_bin_g(ig,jg) = diff_bin_g(ig,jg) * sec_per_days  
	        enddo
	      enddo
 
          do ig = 2,ng
		    do jg = 1,ig-1
		      diff_bin_g(ig,jg) = diff_bin_g(jg,ig)
	        enddo
	      enddo 

	      diff_g = 1.0d0
          if (rank == 0 .and. b_enable_output) then
            write(ilog,'(a)') 'gas diffusion coefficients updated',    &
                              ' based on binary diffusion coeff',      &
                              ' and mol fractions (Blanc s law)'
          end if

        elseif (.not.found_subsection) then

	      blanc_diff_g = .false.  ! default -> same diff coeff for all gases         

        end if
        
!c-----DGM module------------------------------------------------------------
        
	    subsection = 'dusty gas model'

        call findstrg(subsection,itmp,found_subsection)

        if (found_subsection) then

	      dgm = .true.

          do ig = 1,ng-1
            do jg = ig + 1,ng
		      read(itmp,*,err=999,end=999) diff_bin_g(ig,jg)
              diff_bin_g(ig,jg) = diff_bin_g(ig,jg) * sec_per_days  
	        enddo
	      enddo
 
          do ig = 2,ng
		    do jg = 1,ig-1
		      diff_bin_g(ig,jg) = diff_bin_g(jg,ig)
	        enddo
	      enddo 

	      diff_g = 1.0d0
          if (rank == 0 .and. b_enable_output) then
            write(ilog,'(2a)') 'dusty gas model used to calculate',    &
                               ' diffusive fluxes of gas components'
            write(ilog,'(/72a)')('-',i=1,72)
            if (b_enable_output_gen) then
              write(igen,'(2a)') 'dusty gas model used to calculate',  &
                                 ' diffusive fluxes of gas components' 
              write(igen,'(/72a)')('-',i=1,72)
            end if
          end if

	      do ig = 1,ng
		    read(itmp,*,err=999,end=999) visc_comp_g(ig) 	      
	      enddo

!c         assign air viscosity for calculation of knudsen diff coeff
          visc_gcnst      = 1.86d-5
		
!c         use diffusion coeff from blancs law for output for Fick's diffusive flux        
          blanc_diff_g = .true.		  

        elseif (.not.found_subsection) then

	      dgm = .false.  ! default -> use fick's law for diffusion

        end if
        
!c-----Maxwell Stefan module-------------------------------------------------
        
	    subsection = 'maxwell stefan'

        call findstrg(subsection,itmp,found_subsection)

        if (found_subsection) then

	      maxwell = .true.

	      read(itmp,*,err=999,end=999) equi

	      if (equi.eq.'non-equimolar') then
          
	        equimolar = .false.
	      
		  else if (equi.eq.'equimolar') then
          
	        equimolar = .true.
          
	      else
            if (rank == 0 .and. b_enable_output) then
              write(ilog,'(2a)') 'maxwell stefan must be',             &
                                 ' equimolar or non-equimolar'
            end if
	      endif	      

          do ig = 1,ng-1
            do jg = ig + 1,ng
		      read(itmp,*,err=999,end=999) diff_bin_g(ig,jg)
              diff_bin_g(ig,jg) = diff_bin_g(ig,jg) * sec_per_days  
	        enddo
	      enddo
 
          do ig = 2,ng
		    do jg = 1,ig-1
		      diff_bin_g(ig,jg) = diff_bin_g(jg,ig)
	        enddo
	      enddo 

	      diff_g = 1.0d0
          if (rank == 0 .and. b_enable_output) then
            write(ilog,'(2a)') 'maxwell stefan eqs used to calculate',  &
                              ' diffusive fluxes of gas components'
          end if

!c       use diffusion coeff from blancs law for derivatives for now
!c       and output for Fick's diffusive flux        
          blanc_diff_g = .true.

        elseif (.not.found_subsection) then

	      maxwell = .false.  ! default -> use fick's law for diffusion

        end if
        
!c-----for DGM and S-M: correction for temperature and pressure dependence --
        
	    subsection = 'pressure dependence'

        call findstrg(subsection,itmp,found_subsection)

        if (found_subsection) then

	      diff_press = .true.

        elseif (.not.found_subsection) then

	      diff_press = .false.

        end if

        subsection = 'temperature dependence'

        call findstrg(subsection,itmp,found_subsection)

        if (found_subsection) then

	      diff_temp = .true.
          read(itmp,*,err=999,end=999) theta_diff

        elseif (.not.found_subsection) then

	      diff_temp = .false.

        end if
        
!c   read gas density options
        subsection = 'update density'
        call findstrg(subsection,itmp,found_subsection)
        
        if(.not.found_subsection) then
          subsection = 'update gas density'
          call findstrg(subsection,itmp,found_subsection)
        end if

        if (found_subsection) then

	      update_dens_g = .true.

        elseif (.not.found_subsection) then

	      update_dens_g = .false.
		  dens_gcnst      = 1.29d+0

        end if

	    subsection = 'constant gas density'

        call findstrg(subsection,itmp,found_subsection)

        if (found_subsection) then

	      update_dens_g = .false.
	      read(itmp,*,err=999,end=999) dens_gcnst 
		
        end if

!c   read gas viscosity options        
!c       default: constant 
!c       visc_gcnst will be used regardless value of variable_visc_g
	    variable_visc_g = 'constant'
	    visc_gcnst      = 1.86d-5
	  
	    subsection = 'wilke viscosity'

        call findstrg(subsection,itmp,found_subsection)

        if (found_subsection) then

	    variable_visc_g = 'wilke'
          
          do ig = 1,ng
		
            read(itmp,*,err=999,end=999) visc_comp_g(ig) 	      
	      
	    enddo       

        end if

	    subsection = 'linear viscosity'

        call findstrg(subsection,itmp,found_subsection)

        if (found_subsection) then

	      variable_visc_g = 'linear'
          
          do ig = 1,ng
		
            read(itmp,*,err=999,end=999) visc_comp_g(ig) 	      
	      
	      enddo

        end if

	    subsection = 'constant viscosity'

        call findstrg(subsection,itmp,found_subsection)

        if (found_subsection) then

	      variable_visc_g = 'constant'
          read(itmp,*,err=999,end=999) visc_gcnst

        end if

!c  write density and viscosity to generic output file 
        if (rank == 0 .and. b_enable_output) then
          if (.not.update_dens_g) then
  
            if (b_enable_output_gen) then  
              write(igen,'(a,1pe10.3)')                                &
                    'density of the gas phase     = ', dens_gcnst
            end if

          else
	  
	        write(ilog,'(2a)') 'gas density updated based on ',        &
                                'concentration values'  
            write(ilog,'(/72a)')('-',i=1,72)
            if (b_enable_output_gen) then
	          write(igen,'(2a)') 'gas density updated based on ',      &
                                  'concentration values'
              write(igen,'(/72a)')('-',i=1,72)
            end if
          endif 

	      if (variable_visc_g.eq.'constant') then
            if (b_enable_output_gen) then
	          write(igen,'(a,1pe10.3)')                                &
                    'viscosity of the gas phase     = ',visc_gcnst
            end if
          
	      else if (variable_visc_g.eq.'wilke') then
          
	        write(ilog,'(2a)') 'gas viscosity updated based on ',      &
                                'mol fractions (Wilke s expression)'
            write(ilog,'(/72a)')('-',i=1,72)
            if (b_enable_output_gen) then
	          write(igen,'(2a)') 'gas viscosity updated based on ',    &
                                  'mol fractions (Wilke s expression)'
              write(igen,'(/72a)')('-',i=1,72)
            end if
          
	      else if (variable_visc_g.eq.'linear') then
          
	        write(ilog,'(2a)') 'gas viscosity updated based on ',      &
                                'mol fractions (linear update)'
            write(ilog,'(/72a)')('-',i=1,72)
            if (b_enable_output_gen) then
	          write(igen,'(2a)') 'gas viscosity updated based on ',    &
                                  'mol fractions (linear update)'
              write(igen,'(/72a)')('-',i=1,72)
            end if
          
          endif
          
        end if

!c       use lennard-jones potential to calculate diffusion coefficients
	    subsection = 'lennard-jones'

        call findstrg(subsection,itmp,found_subsection)

        if (found_subsection) then

          if (rank == 0 .and. b_enable_output) then  
	        if (dgm.or.maxwell) then                 
		      write(ilog,'(2a)')                                       &
                    ' The Lennard-Jones potential is used',            &
                    ' to calculate diffusion coefficients '            
	        else             
              write(ilog,'(2a)')                                       &
                    ' WARNING: the Lennard-Jones potential ',          &
                    'is not used for diffusion coefficients '
	          write(ilog,'(2a)')                                       &
                    ' "dusty gas model" or "maxwell stefan"',          &
                    ' keyword is missing'	 
            endif

	        if (variable_visc_g.eq.'constant') then             
              write(ilog,'(2a)')                                       &
                    ' WARNING: the Lennard-Jones potential ',          &
                    'is not used for viscosity coefficients '
	          write(ilog,'(2a)')                                       &
                    '"wilke viscosity" or "linear viscosity"',         &
                    ' keyword is missing'
            else            
	          write(ilog,'(2a)')                                       &
                    ' The Lennard-Jones potential is used',            &
                    ' to calculate viscosity coefficients '		    
            endif
          
            write(ilog,'(/72a)')('-',i=1,72)
            
          end if

!c         read sigma and epsilon/k
	      do ig = 1,ng
	        read(itmp,*,err=999,end=999) sigma(ig), epsil(ig)
	      enddo

!c         calculate Dij, visc_i
          call lennard_jones(sigma,epsil,visc_comp_g,diff_bin_g)

        elseif (.not.found_subsection) then

!         diffusion/visosity coefficients have been specified

        end if
!c     end new - sergi 
        
!cprovi--------------------------------------------------------
!cprovi Read component dependent diffusion coefficients
!cprovi--------------------------------------------------------        
        diff_coff = .false.

        subsection =                                              &
     &      'component dependent diffusion coefficients in water'

        call findstrg(subsection,itmp,found_subsection)

        if (found_subsection) then

          diff_coff = .true.
          if (b_enable_output .and. b_enable_output_gen) then
             write (igen,'(/a/)')                                      &
     &        'Component dependent diffusion coefficients:'
          end if
          
        do ic = 1,nc-1
            read(itmp,*,err=999,end=999) diff_a

!c_bubbles write component dependent coefficients to generic output file
            if (b_enable_output .and. b_enable_output_gen) then
              write(igen,'(3a,1pe10.3)')                              &
     &        'diffusion coefficient in aqueous phase for component ',&
     &        namec(ic)(:l_namec(ic)),'  = ',                         &
     &        diff_a
            end if
!c  conversion of time units for computation in days

               diff_ic(ic) = diff_a * sec_per_days
              
          end do
        
        end if
        
        if (hmulti_diff) then
 
!c  read material properties for material property zones from input file
               
          do izn = 1,nzn                !loop over property zones

!c  search for entry for material property zone in input file

            zone_name = mprop_name(izn)

!c  define length of name of material property zone

            l_zone_name = index(zone_name,'  ')-1
            if (l_zone_name.lt.0.or.l_zone_name.gt.72) then
              l_zone_name = 72
            end if

!c  search temporary data file for current material property zone
!c  and write to scratch file

            call readbloc (itmp,icnv,zone_name,found_subsection,.true.)

!c  read correction factors of porosity and tortuosity for species for hybrid MCD model

              if (found_subsection) then

!c  read correction factors of porosity for primary species

              subsection = 'porosity correction factor of primary species for hMCD diffusion'
                
!c  search temporary data file for current material property zone
!c  and write to scratch file

              call findstrginzone(subsection,icnv,found_subsection)
              
              epor_diff = .false.
              
              if (found_subsection) then
                epor_diff = .true.
                if (b_enable_output .and. b_enable_output_gen) then  
                  write (igen,'(/a/)')                                    &
         &        'porosity correction factor of primary species in zone: ', zone_name
                end if
                  !read(itmp, *) subsection
                  !write(*,*) subsection
                  
                  do ic = 1,nc-1-nna-nbio
                    read(icnv,*,err=999,end=999) f_epor_ps(ic,izn)   

    !c_bubbles write component dependent coefficients to generic output file
                    if (b_enable_output .and. b_enable_output_gen) then
                      write(igen,'(3a,1pe10.3)')                          &
         &              'porosity correction factor for primary species ',&
         &              namec(ic)(:l_namec(ic)),'  = ',                   &
         &              f_epor_ps(ic,izn)
                    end if
         
                  end do
        
               end if   
                
!c  read correction factors of tortuosity for primary species

              subsection = 'tortuosity correction factor of primary species for hMCD diffusion'
                
!c  search temporary data file for current material property zone
!c  and write to scratch file

              call findstrginzone(subsection,icnv,found_subsection)
              
              
              if (found_subsection) then
                epor_diff = .true.
                if (b_enable_output .and. b_enable_output_gen) then  
                  write (igen,'(/a )')                                    &
         &        'tortuosity correction factor of primary species in zone: ', zone_name
                end if
                  !read(itmp, *) subsection
                  !write(*,*) subsection
                  
                  do ic = 1,nc-1-nna-nbio
                    read(icnv,*,err=999,end=999) f_etau_ps(ic,izn)   

    !c_bubbles write component dependent coefficients to generic output file
                    if (b_enable_output .and. b_enable_output_gen) then
                      write(igen,'(3a,1pe10.3)')                           &
         &              'tortuosity correction factor for primary specie ',&
         &              namec(ic)(:l_namec(ic)),'  = ',                    &
         &              f_etau_ps(ic,izn)
                    end if
         
                   end do
        
              end if 
              
!c  read correction factors of porosity for secondary species

              subsection = 'porosity correction factor of secondary species for hMCD diffusion'
                
!c  search temporary data file for current material property zone
!c  and write to scratch file

              call findstrginzone(subsection,icnv,found_subsection)
              
              epor_diff = .false.
              
              if (found_subsection) then
                epor_diff = .true.
                if (b_enable_output .and. b_enable_output_gen) then
                  write (igen,'(/a/)')                                    &
         &        'porosity correction factor of secondary species in zone: ', zone_name
                end if
                  !read(itmp, *) subsection
                  !write(*,*) subsection
                  
                  do ix = 1,nx
                    read(icnv,*,err=999,end=999) f_epor_ss(ix,izn)   

    !c_bubbles write component dependent coefficients to generic output file
                    if (b_enable_output .and. b_enable_output_gen) then
                      write(igen,'(3a,1pe10.3)')                            &
         &              'porosity correction factor for secondary species ',&
         &              namex(ix)(:l_namex(ix)),'  = ',                     &
         &              f_epor_ss(ix,izn)
                    end if
         
                   end do
        
              end if   !porosity correction factor of secondary species

              
!c  read correction factors of tortuosity for secondary species

              subsection = 'tortuosity correction factor of secondary species for hMCD diffusion'
                
!c  search temporary data file for current material property zone
!c  and write to scratch file

              call findstrginzone(subsection,icnv,found_subsection)
              
              
              if (found_subsection) then
                epor_diff = .true.
                if (b_enable_output .and. b_enable_output_gen) then
                  write (igen,'(/a )')                                    &
         &        'tortuosity correction factor of secondary species in zone: ', zone_name
                end if
                  !read(itmp, *) subsection
                  !write(*,*) subsection
                  
                  do ix = 1,nx
                    read(icnv,*,err=999,end=999) f_etau_ss(ix,izn)   

    !c_bubbles write component dependent coefficients to generic output file
                    if (b_enable_output .and. b_enable_output_gen) then
                      write(igen,'(3a,1pe10.3)')                             &
         &              'tortuosity correction factor for secondary specie ',&
         &              namex(ix)(:l_namex(ix)),'  = ',                      &
         &              f_etau_ss(ix,izn)
                    end if
         
                   end do
        
              end if   !
              
              
              else if (.not. epor_diff) then
                  if (b_enable_output .and. b_enable_output_gen) then
                    write (igen,'(/a/)')                                    &
         &        'Warning: no correction factors of porosity and tortuosity assigned for any zone' 
                  end if  
             
            end if
          end do
          end if  !hmulti_diff 
       
!cmx--------------------------------------------------------
!cmx  Read effective porosity factor for MCD diffusion - DL effect
!cmx   f_epor = effective porosity/total porosity
!cmx--------------------------------------------------------        
      if (.not. hmulti_diff .and. multi_diff) then
        epor_diff = .false.

        subsection =                                              &
     &      'effective porosity factor for MCD diffusion'

        call findstrg(subsection,itmp,found_subsection)

        if (found_subsection) then

            epor_diff = .true.
            if (b_enable_output .and. b_enable_output_gen) then
              write (igen,'(/a/)')                                    &
         &          'effective porosity factor for MCD diffusion:'
            end if
        
            do ic = 1,nc-1
                read(itmp,*,err=999,end=999) f_epor(ic)

    !c_bubbles write component dependent coefficients to generic output file
                if (b_enable_output .and. b_enable_output_gen) then
                  write(igen,'(3a,1pe10.3)')                              &
         &        'effective porosity factor in aqueous phase for component ',&
         &        namec(ic)(:l_namec(ic)),'  = ',                         &
         &        f_epor(ic)
                end if
         
              end do
        
        end if        
        
!cmx--------------------------------------------------------
!cmx  Read effective tortuosity factor for MCD diffusion - surface diffusion effect
!cmx   f_etau = effective tortuosity factor
!cmx--------------------------------------------------------        

        subsection =                                              &
     &      'effective tortuosity factor for MCD diffusion'

        call findstrg(subsection,itmp,found_subsection)

        if (found_subsection) then

            epor_diff = .true.
            if (b_enable_output .and. b_enable_output_gen) then
              write (igen,'(/a/)')                                    &
         &          'effective tortuosity factor for MCD diffusion:'
            end if
        
            do ic = 1,nc-1
                read(itmp,*,err=999,end=999) f_etau(ic)

    !c_bubbles write component dependent coefficients to generic output file
                if (b_enable_output .and. b_enable_output_gen) then
                  write(igen,'(3a,1pe10.3)')                              &
         &        'effective tortuosity factor for primary species ',&
         &        namec(ic)(:l_namec(ic)),'  = ',                         &
         &        f_etau(ic)
                end if
         
              end do
        
            end if     
      end if        
       
        
!cprovi--------------------------------------------------------
!cprovi--------------------------------------------------------
!cprovi--------------------------------------------------------
!c  loop over property zones for 

        do izn = 1,nzn                !loop over property zones

!c  assign defaults for physical parameters for reactivs transport

          disy(izn) = r0
          disz(izn) = r0

!c  search for entry for material property zone in input file

          zone_name = mprop_name(izn)

!c  define length of name of material property zone

          l_zone_name = index(zone_name,'  ')-1
          if (l_zone_name.lt.0.or.l_zone_name.gt.72) then
            l_zone_name = 72
          end if

!c  search temporary data file for current material property zone
!c  and write to scratch file

          call readbloc (itmp,icnv,zone_name,found_subsection,.true.)

!c  read material properties

          if (found_subsection) then

!c  read physical parameters for reactive transport
   
!c  longitudinal dispersivity

            subsection = 'longitudinal dispersivity'

            call findstrg(subsection,icnv,found_subsection)

            if (found_subsection) then

              read(icnv,*,err=999,end=999) disx(izn)

            elseif (.not.found_subsection) then
              if (rank == 0) then
                l_string = index(subsection,'  ')-1
                if (l_string.eq.-1.or.l_string.gt.72) then
                   l_string=72
                end if
                write(ilog,*) 'error reading input file'            
                write(ilog,*) 'subsection "',subsection(:l_string), &
     &                     '" missing'
                close(ilog)
              end if
#ifdef PETSC
              call petsc_mpi_finalize
#endif
              stop

            end if

!c  transverse horizontal dispersivities

            if (nvx.gt.1.and.nvy.gt.1) then

              subsection = 'transverse horizontal dispersivity'

              call findstrg(subsection,icnv,found_subsection)

              if (found_subsection) then

                read(icnv,*,err=999,end=999) disy(izn)

              elseif (.not.found_subsection) then
                if (rank == 0) then
                  l_string = index(subsection,'  ')-1
                  if (l_string.eq.-1.or.l_string.gt.72) then
                     l_string=72
                  end if
                  write(ilog,*) 'error reading input file'
                  write(ilog,*) 'subsection "',subsection(:l_string),   &
     &                         '" missing'
                  close(ilog)
                end if
#ifdef PETSC
                call petsc_mpi_finalize
#endif
                stop
   
              end if          !(found_subsection)

            end if            !(nvx.gt.1......)

!c  transverse vertical dispersivities

            if (nvx.gt.1.and.nvz.gt.1.or.                             &
     &          nvy.gt.1.and.nvz.gt.1) then

              subsection = 'transverse vertical dispersivity'

              call findstrg(subsection,icnv,found_subsection)

              if (found_subsection) then

                read(icnv,*,err=999,end=999) disz(izn)

              elseif (.not.found_subsection) then
                if (rank == 0) then
                  l_string = index(subsection,'  ')-1
                  if (l_string.eq.-1.or.l_string.gt.72) then
                     l_string=72
                  end if
                  write(ilog,*) 'error reading input file'
                  write(ilog,*) 'subsection "',subsection(:l_string),   &
     &                         '" missing'
                  close(ilog)
                end if
#ifdef PETSC
                call petsc_mpi_finalize
#endif
                stop
  
              end if          !(found_subsection)

            end if            !(nvx.gt.1.....)

!c  write dispersivities for current material property zone
!c  to generic output file
   
!c  write parameters for variably saturated flow to generic output file

            if (b_enable_output .and. b_enable_output_gen) then

            if (nzn.lt.10) then
              write(igen,'(/a,i1,a,1x,a)') 'material property zone ', &
     &                                      izn,':',                  &
     &                                      zone_name(:l_zone_name)
            else
              write(igen,'(/a,i2,a,1x,a)') 'material property zone ', &
     &                                      izn,':',                  &
     &                                      zone_name(:l_zone_name)
            end if

            write(igen,'(72a)')('-',i=1,72)
            write(igen,'(a,1pe10.3)')                                 &
     &      'longitudinal dispersivity                       = ',     &
     &       disx(izn)

            if (nvx.gt.1.and.nvy.gt.1.or.                             &
     &          nvx.gt.1.and.nvz.gt.1.or.                             &
     &          nvy.gt.1.and.nvz.gt.1) then
              write(igen,'(a,1pe10.3)')                               &
     &        'transverse horizontal dispersivity              = ',   &
     &         disy(izn)
            end if

            if (nvx.gt.1.and.nvy.gt.1.and.nvz.gt.1) then
              write(igen,'(a,1pe10.3)')                               &
     &        'transverse vertical dispersivity                = ',   &
     &         disz(izn)
            end if
            
            end if

          elseif (.not.found_subsection) then
              
            if (rank == 0) then  

              write(ilog,*) 'error reading section "',                &
     &                      section_header(:l_string),                &
     &                     '" in input file'
              write(ilog,*) 'entry for material property zone "',     &
     &                      zone_name(:l_zone_name),'" missing'
              close(ilog)
            end if
            
#ifdef PETSC
            call petsc_mpi_finalize
#endif
            stop

          end if         !(found_subsection)

        end do           !loop over material property zones

      end if             !(found_section)

      goto 1000

999   continue
      if (rank == 0) then
        write(ilog,*) 'error reading input file'
        write(ilog,*) 'section "',section_header(:l_string),'"'
        close(ilog)
      end if
#ifdef PETSC
      call petsc_mpi_finalize
#endif
      stop

1000  return
      end
