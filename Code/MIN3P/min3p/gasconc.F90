!*****Revision Informations Automatically Generated by VisualSVN*****!
!---------------------------------------------------------------------
!> $ID:$
!> $Revision: 453 $
!> $Author: dsu $
!> $Date: 2017-02-21 19:54:05 +0100 (Tue, 21 Feb 2017) $
!> $URL: https://biot.eos.ubc.ca/svn/min3p_thcm/branches/fgerard_new/src/min3p/gasconc.F90 $
!---------------------------------------------------------------------
!********************************************************************!

!c -----------------------------------------------------------------------
!c subroutine gasconc
!c ------------------
!c compute gas concentration in air phase based on concentrations 
!c of free species in aqueous phase 
!c
!c written by:      Uli Mayer - September 24, 96
!c
!c last modified:   Uli Mayer - November 28, 96   
!c
!c definition of variables:
!c
!c I --> on input   * arbitrary  - initialized  + entries expected
!c O --> on output  * arbitrary  - unaltered    + altered
!c                                                                    I O
!c passed:   real*8:
!c           -------
!c           c(nc)              = concentrations of free species      + -
!c                                [moles/l water]
!c           gammac(nc)         = activity coefficients of free       + -
!c                                species
!c           g                  = gas concentration of gas            * +
!c                                [moles/l air]
!c           ig                 = pointer to gas                      + -
!c           tempkel            = temperature [deg K]                 + -
!c
!c common:
!c chem.f:   real*8:
!c           -------
!c           eqg(ng,nthreads)   = equilibrium constants for           + -
!c                                formation of gases from free
!c                                species
!c           rgasatm            = ideal gas constant                  + -
!c                                [liter atm/(deg K mole)]
!c           xnug(ng*nc)        = stoichiometric coefficient matrix   + -
!c                                for formation of gases from
!c                                free species
!c
!c           integer*4:
!c           ----------
!c           iaga(ng+1)         = row pointer array to                + -
!c                                stoichiometric coefficients of
!c                                free species in gases
!c           jaga(ng*nc)        = column pointer array to             + -
!c                                stoichiometric coefficients of
!c                                free species in gases
!c           nc                 = number of components                + -
!c
!c
!c
!c local:    real*8:
!c           -------
!c           r1                 = constant
!c
!c           integer*4:
!c           ----------
!c           i                  = counter (stoichiometric 
!c                                coefficients)
!c           ic                 = counter (components)
!c           istart             = pointer (stoichiometric
!c                                coefficients)
!c           iend               = pointer (stoichiometric
!c                                coefficients)
!c
!c external: -  
!c ----------------------------------------------------------------------
  
      subroutine gasconc(c,gammac,g,ig,tempkel)
 
      use parm
      use chem
#ifdef OPENMP
      use omp_lib 
#endif
 
      implicit none
      
      real*8 :: c, gammac, g, tempkel
      
      integer :: ig
      
      integer :: tid, i, ic, istart, iend

      dimension c(*),gammac(*)

      real*8, parameter :: r1 = 1.0d0
      
#ifdef OPENMP
      tid = omp_get_thread_num() + 1
#else
      tid = 1
#endif
 
!c  convert from [atm] to [moles/l air]
      g = r1/(rgasatm*tempkel*eqg(ig,tid))
 
      istart = iaga(ig)
      iend = iaga(ig+1)-1
      do i = istart,iend
        ic = jaga(i)
        g = g * (gammac(ic)*c(ic))**xnug(i)
      end do
 
      return
      end
