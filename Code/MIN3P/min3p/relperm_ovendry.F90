!*****Revision Informations Automatically Generated by VisualSVN*****!
!---------------------------------------------------------------------
!> $ID:$
!> $Revision: 3 $
!> $Author: dsu $
!> $Date: 2012-12-10 03:46:07 +0100 (Mon, 10 Dec 2012) $
!> $URL: https://biot.eos.ubc.ca/svn/min3p_thcm/branches/fgerard_new/src/min3p/relperm_ovendry.F90 $
!---------------------------------------------------------------------
!********************************************************************!

!c ----------------------------------------------------------------------
!c relperm_ovendry
!c Compute the relative hydraulic conductivity for oven-dryness 
!c condictions (Fayer and Simmons, 1985). 
!c ----------------------------------------------------------------------

real*8 function relperm_ovendry(sw,swr,mualem,alpha,n,m,beta,h,hm,hg,w0,cp0) 

implicit none 

real*8, intent(in)    :: swr

real*8, intent(in)    :: sw

real*8, intent(in)    :: mualem

real*8, intent(in)    :: w0

real*8, intent(in)    :: cp0

real*8, intent(in)    :: alpha          ! Van Genuchten parameter

real*8, intent(in)    :: h

real*8, intent(in)    :: hm

real*8, intent(in)    :: hg

real*8, intent(in)    :: beta        

real*8, intent(in)    :: n              ! Van Genuchten parameter

real*8, intent(in)    :: m              ! Van Genuchten parameter
!-------------------------------------------------------------------------------------------
! Local variables 
!-------------------------------------------------------------------------------------------
real*8                :: gamma, &
                         term1, &
                         term2, &
                         term3, &
                         term4, &
                         alpha_loc, &
                         beta_loc, &
                         alphah0, &
                         alphah, &
                         alphahc, &
                         alphahm, &
                         betah0, &
                         betahm, &
                         int_h , &
                         int_h_ovendry, &
                         int_h0, &
                         int_0c, &
                         int_max, &
                         n1, &
                         sw_loc, &
                         inv_n1, &
                         hc, &
                         h0
!-------------------------------------------------------------------------------------------
! Local constants
!-------------------------------------------------------------------------------------------
real*8, parameter    :: r0025 = 0.5d0, &
                        r1 = 1.0d0, &
                        r2 = 2.0d0, &
                        rsmall = 1.0d-20, &
                        r100 = 100.0d0
!-------------------------------------------------------------------------------------------
!-------------------------------------------------------------------------------------------
!-------------------------------------------------------------------------------------------                        
!-------------------------------------------------------------------------------------------

hc = hg - rsmall 

h0 = -cp0/alpha

alphah = dabs(alpha*h)

alphah0 = dabs(alpha*h0)

alphahc = dabs(alpha*hc)

alphahm = dabs(alpha*hm)

betah0 = dabs(beta*h0)

betahm = dabs(beta*hm)  

gamma = dlog(dabs(alpha/beta))/dlog(betahm)

n1=n-r1 
inv_n1 = r1/n1    
!-------------------------------------------------------------------------------------------
! Compute integrals 
!-------------------------------------------------------------------------------------------
int_h = int_h_ovendry(swr,alpha,n,m,beta,h,hc,h0,hm,hg,w0) 
int_h0 = int_h_ovendry(swr,alpha,n,m,beta,h0,hc,h0,hm,hg,w0)        
!-------------------------------------------------------------------------------------------
! Compute int_0c
!-------------------------------------------------------------------------------------------        
term1 = alpha * (r1-gamma*swr - swr + (swr/(n*dlog(betahm)))) * (alphah0**n1 - alphahc**n1)
term4 = alpha*swr/dlog(betahm)
term2 = (alphah0**n1) * (dlog(alphah0)-inv_n1) 
        
term3 = - (alphahc**n1) * (dlog(alphahc) - inv_n1)

int_0c = term1 + term4 * (term2 + term3) 
!-------------------------------------------------------------------------------------------
! Compute maximum integration 
!-------------------------------------------------------------------------------------------
int_max = int_h0 + int_0c   
!-------------------------------------------------------------------------------------------
! Compute the liquid saturation 
!-------------------------------------------------------------------------------------------
term1 = r1 - (dlog(alphah)/dlog(betahm))  
term1 = term1 + gamma
term2 = r1 + (dabs(alpha*(h-hg)))**n
sw_loc = term1*swr + (r1 - term1*swr)/(term2**m)
!-------------------------------------------------------------------------------------------
! Compute the relative hydraulic conductivity using the Mualem (1976) expression 
!-------------------------------------------------------------------------------------------
term1 = sw_loc**mualem
term2 = (int_h/int_max)**r2
relperm_ovendry = term1 * term2 
 
return 
end function