!*****Revision Informations Automatically Generated by VisualSVN*****!
!---------------------------------------------------------------------
!> $ID:$
!> $Revision: 453 $
!> $Author: dsu $
!> $Date: 2017-02-21 19:54:05 +0100 (Tue, 21 Feb 2017) $
!> $URL: https://biot.eos.ubc.ca/svn/min3p_thcm/branches/fgerard_new/src/min3p/mem_njavs.F90 $
!---------------------------------------------------------------------
!********************************************************************!

!c -----------------------------------------------------------------------
!c subroutine mem_njavs
!c --------------------
!c
!c allocate memory for one-dimensional arrays of size njavs
!c
!c written by:      Uli Mayer - January 6, 2000
!c
!c last modified:   -
!c
!c definition of variables:
!c
!c I --> on input   * arbitrary  - initialized  + entries expected
!c O --> on output  * arbitrary  - unaltered    + altered
!c                                                                    I O
!c passed:   -
!c
!c common:
!c gen.f:    real*8:
!c           -------
!c           cinfrt_va(njavs)   = influence coefficients              * +
!c                                (advection - aqueous phase)
!c           cinfrt_da(njavs)   = influence coefficients              * +
!c                                (dispersion - aqueous phase)
!c           cinfrt_dg(njavs)   = influence coefficients              * +
!c                                (diffusion - gaseous phase)
!c           cinfvs(njavs)      = influence coefficients              * +
!c                                (variably saturated flow)

!c Added for Multi-Diff
!c           deltaij(njavs)     = distance between i-j                * +
!c           tauij(njavs)       = aqueous tortuosity at i-j           * +
!c           porij(njavs)       = aqueous filled porosity at i-j      * +
!c           gsatij(njavs)      = gas saturation at i-j               * +
!c           satij(njavs)       = aqueous saturation at i-j           * +
!c added for gas transport:
!c 
!c           deltaij(njavs)     = distance between i-j                * +
!c           tauij(njavs)       = gas tortuosity at i-j               * +
!c           gporij(njavs)      = gas-filled porosity at i-j          * +
!c           gsatij(njavs)      = gas saturation at i-j               * +
!c 
!c           integer*4:
!c           ----------
!c           iupsg(njavs)       = upstream node for gas transport     * +
!c
!c -------------------------
!c           integer*4:
!c           ----------
!c           ilog               = unit number, logbook file           + -
!c           isymvs(njavs)      = symmetry pointer array              + +
!c           iwork(:)           = integer work array                  * *
!c           javs(njavs)        = connectivity list for 1d-scalar     + +
!c                                matrix
!c           lart(njavs+1)      = pointer array                       * +
!c           njavs              = number of global connections        + -
!c
!c           logical:
!c           --------
!c           reactive_transport = .true.  -> perform reactive         + -
!c                                           transport simulation
!c           varsat_flow        = .true.  -> perform flow simulation  + -
!c
!c local:    integer*4:
!c           ----------
!c           i1                 = pointer
!c           ierr               = 0 -> memory allocation successful
!c
!c external: checkerr  = check for error during memory allocation
!c
!c---------------------------------------------------------------------- 
!c WARNING
!c---------------------------------------------------------------------- 
!c All allocated variables are initialized to some value. This depends  
!c of its type:
!c 
!c real*8      => 0.0d0
!c integer     => 0 
!c character   => ' '    
!c logical     => .false. 
!c 
!c Sergio Andres Bea Jofre (2009)
!c
!c ----------------------------------------------------------------------
  
      subroutine mem_njavs
 
      use parm
      use gen
      use chem 
#ifdef OPENMP
      use omp_lib 
#endif
 
      implicit none
      
      integer :: i1, ierr

      external checkerr
      
      real*8, parameter    :: r0=0.0d0
      
!c  allocate work array  
      allocate (iwork(njavs), stat = ierr)
      iwork=0
      call checkerr(ierr,'iwork',ilog)
      
!c  minimize memory requirements for array javs

      do i1 = 1,njavs
        iwork(i1) = javs(i1)
      end do

      deallocate (javs, stat = ierr)
      call checkerr(ierr,'javs',ilog)

      allocate (javs(njavs), stat = ierr)
      javs=0
      call checkerr(ierr,'javs',ilog)

      do i1 = 1,njavs
        javs(i1) = iwork(i1)
      end do
      
#ifdef PETSC
      do i1 = 1,njavs
        iwork(i1) = col_idx_l2pg_vs(i1)
      end do

      deallocate (col_idx_l2pg_vs, stat = ierr)
      call checkerr(ierr,'col_idx_l2pg_vs',ilog)

      allocate (col_idx_l2pg_vs(njavs), stat = ierr)
      col_idx_l2pg_vs=0
      call checkerr(ierr,'col_idx_l2pg_vs',ilog)

      do i1 = 1,njavs
        col_idx_l2pg_vs(i1) = iwork(i1)
      end do
#endif

!c  minimize memory requirements for array isymvs

      do i1 = 1,njavs
        iwork(i1) = isymvs(i1)
      end do

      deallocate (isymvs, stat = ierr)
      call checkerr(ierr,'isymvs',ilog)

      allocate (isymvs(njavs), stat = ierr)
      isymvs=0
      call checkerr(ierr,'isymvs',ilog)

      do i1 = 1,njavs
        isymvs(i1) = iwork(i1)
      end do
      
!c  deallocate work array      
      deallocate (iwork, stat = ierr)
      call checkerr(ierr,'iwork',ilog)

#ifdef OPENMP
#ifdef PARALLEL_SECTION
    !$omp parallel private(ierr)
    !$omp sections
#endif
#endif
     
!c  arrays for flow solution
#ifdef OPENMP
#ifdef PARALLEL_SECTION
    !$omp section
#endif
#endif
      allocate (cinfvs(njavs), stat = ierr)
      cinfvs=r0
      call checkerr(ierr,'cinfvs',ilog)
#ifdef OPENMP
#ifdef PARALLEL_SECTION
    !$omp section
#endif
#endif
      allocate (cinfrad(njavs), stat = ierr)
      cinfrad=r0
      call checkerr(ierr,'cinfrad',ilog)
      
#ifdef OPENMP
#ifdef PARALLEL_SECTION
    !$omp section
#endif
#endif
      allocate (cinfvs_a(njavs), stat = ierr)
      cinfvs_a=r0
      call checkerr(ierr,'cinfvs_a',ilog)
      
#ifdef OPENMP
#ifdef PARALLEL_SECTION
    !$omp section
#endif
#endif
      allocate (cinfvs_g(njavs), stat = ierr)
      cinfvs_g=r0
      call checkerr(ierr,'cinfvs_g',ilog)
#ifdef OPENMP
#ifdef PARALLEL_SECTION
    !$omp section
#endif
#endif
      allocate (permij(njavs), stat = ierr)
      permij=r0
      call checkerr(ierr,'permij',ilog)
!c  arrays for reactive transport solutione
#ifdef OPENMP
#ifdef PARALLEL_SECTION
    !$omp section
#endif
#endif
      if (reactive_transport) then
        allocate (cinfrt_va(njavs), stat = ierr)
        cinfrt_va=r0
        call checkerr(ierr,'cinfrt_va',ilog)
      end if
#ifdef OPENMP
#ifdef PARALLEL_SECTION
    !$omp section
#endif
#endif
      if (reactive_transport) then
        allocate (cinfrt_da(njavs), stat = ierr)
        cinfrt_da=r0
        call checkerr(ierr,'cinfrt_da',ilog)
      end if
      
#ifdef OPENMP
#ifdef PARALLEL_SECTION
    !$omp section
#endif
#endif  
      if (reactive_transport) then
        allocate (cinfrt_dg(njavs), stat = ierr)
        cinfrt_dg=r0
        call checkerr(ierr,'cinfrt_dg',ilog)
      end if
#ifdef OPENMP
#ifdef PARALLEL_SECTION
    !$omp section
#endif
#endif  
      if (reactive_transport) then
        allocate (lart(njavs+1), stat = ierr)
        lart=0 
        call checkerr(ierr,'lart',ilog)
      end if  
      
#ifdef OPENMP
#ifdef PARALLEL_SECTION
    !$omp section
#endif
#endif  
      if (reactive_transport) then
        allocate (iupsg(njavs), stat = ierr)
        iupsg = ' '
        call checkerr(ierr,'iupsg',ilog)
      end if  
      
#ifdef OPENMP
#ifdef PARALLEL_SECTION
    !$omp section
#endif
#endif  
      if (reactive_transport) then
        allocate (gsatij(njavs), stat = ierr)
        gsatij = r0
        call checkerr(ierr,'gsatij',ilog)
      end if 
      
!cprovi-----------------------------------------------------------
!cprovi-----------------------------------------------------------
!cprovi-----------------------------------------------------------
#ifdef OPENMP
#ifdef PARALLEL_SECTION
    !$omp section
#endif
#endif
      if (reactive_transport) then
        allocate (cinfrt_da_ic(njavs,nc), stat = ierr)
        call checkerr(ierr,'cinfrt_da_ic',ilog)
        cinfrt_da_ic=r0         
      end if        
     
!CMX test        if (multi_diff) then
#ifdef OPENMP
#ifdef PARALLEL_SECTION
    !$omp section
#endif
#endif
      if (reactive_transport) then
        allocate (cinfrt_mcd(njavs), stat = ierr)
        cinfrt_mcd=0.0d0
        call checkerr(ierr,'cinfrt_mcd',ilog)
      end if
#ifdef OPENMP
#ifdef PARALLEL_SECTION
    !$omp section
#endif
#endif        
      if (reactive_transport) then
        allocate (deltaij(njavs), stat = ierr)
        deltaij=0.0d0
        call checkerr(ierr,'deltaij',ilog)
      end if
#ifdef OPENMP
#ifdef PARALLEL_SECTION
    !$omp section
#endif
#endif        
      if (reactive_transport) then
        allocate (gporij(njavs), stat = ierr)
        gporij=0.0d0
        call checkerr(ierr,'gporij',ilog)
      end if
#ifdef OPENMP
#ifdef PARALLEL_SECTION
    !$omp section
#endif
#endif  
      if (reactive_transport) then
        allocate (tauij(njavs), stat = ierr)
        tauij=0.0d0
        call checkerr(ierr,'tauij',ilog)
      end if
#ifdef OPENMP
#ifdef PARALLEL_SECTION
    !$omp section
#endif
#endif
      if (reactive_transport) then
        allocate (porij(njavs), stat = ierr)
        porij=0.0d0
        call checkerr(ierr,'porij',ilog)
      end if
#ifdef OPENMP
#ifdef PARALLEL_SECTION
    !$omp section
#endif
#endif
      if (reactive_transport) then
        allocate (satij(njavs), stat = ierr)
        satij=0.0d0
        call checkerr(ierr,'satij',ilog)
      end if
#ifdef OPENMP
#ifdef PARALLEL_SECTION
    !$omp section
#endif
#endif 
      if (reactive_transport) then
        allocate (area_d(njavs), stat = ierr)
        area_d=0.0d0
        call checkerr(ierr,'area_d',ilog)
      end if
#ifdef OPENMP
#ifdef PARALLEL_SECTION
    !$omp section
#endif
#endif 
      if (reactive_transport) then
        allocate (mdiff_ic_cvol(nc, njavs), stat = ierr)
        mdiff_ic_cvol=0.0d0 
        call checkerr(ierr,'mdiff_ic_cvol',ilog)
      end if
#ifdef OPENMP
#ifdef PARALLEL_SECTION
    !$omp section
#endif
#endif
      if (reactive_transport) then
        allocate (mdiff_ix_cvol(nx, njavs), stat = ierr)
        mdiff_ix_cvol=0.0d0 
        call checkerr(ierr,'mdiff_ix_cvol',ilog)
      end if
#ifdef OPENMP
#ifdef PARALLEL_SECTION
    !$omp section
#endif
#endif
      if (reactive_transport) then  
        allocate (vel_lin(njavs), stat = ierr)
        vel_lin=0.0d0
        call checkerr(ierr,'vel_lin',ilog)        
      end if
!CMX    end if   ! multi_diff
 
!cprovi-----------------------------------------------------------
!cprovi-----------------------------------------------------------
!cprovi-----------------------------------------------------------
#ifdef OPENMP
#ifdef PARALLEL_SECTION
    !$omp section
#endif
#endif
        if (heat_transport) then 
            allocate (cinfheat_c(njavs), stat = ierr)
            cinfheat_c=r0
            call checkerr(ierr,'cinfheat_c',ilog)
        end if
#ifdef OPENMP
#ifdef PARALLEL_SECTION
    !$omp section
#endif
#endif
        if (heat_transport) then
            allocate (cinfheat_d(njavs), stat = ierr)
            cinfheat_d=r0
            call checkerr(ierr,'cinfheat_d',ilog)
        end if
#ifdef OPENMP
#ifdef PARALLEL_SECTION
    !$omp section
#endif
#endif
        if (heat_transport) then
            allocate (distcells(njavs,2), stat = ierr)
            distcells=r0
            call checkerr(ierr,'distcells',ilog)        
        end if
#ifdef OPENMP
#ifdef PARALLEL_SECTION
    !$omp section
#endif
#endif
        if (heat_transport.and.evaporation.and.variably_saturated) then
           allocate (cinfevap_pa(njavs), stat = ierr)
           cinfevap_pa=r0
           call checkerr(ierr,'cinfevap_pa',ilog)
        end if
#ifdef OPENMP
#ifdef PARALLEL_SECTION
    !$omp section
#endif
#endif
        if (heat_transport.and.evaporation.and.variably_saturated) then
           allocate (cinfevap_t(njavs), stat = ierr)
           cinfevap_t=r0
           call checkerr(ierr,'cinfevap_t',ilog) 
        end if   
#ifdef OPENMP
#ifdef PARALLEL_SECTION
    !$omp section
#endif
#endif
        if (heat_transport.and.evaporation.and.variably_saturated) then
           allocate (cinfvs_t(njavs), stat = ierr)
           cinfvs_t=r0
           call checkerr(ierr,'cinfvs_t',ilog)              
        end if
#ifdef OPENMP
#ifdef PARALLEL_SECTION
    !$omp end sections
    !$omp end parallel
#endif
#endif       
!cprovi-----------------------------------------------------------
!cprovi-----------------------------------------------------------
!cprovi-----------------------------------------------------------  
      return
      end
