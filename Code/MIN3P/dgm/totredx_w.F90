!*****Revision Informations Automatically Generated by VisualSVN*****!
!---------------------------------------------------------------------
!> $ID:$
!> $Revision: 296 $
!> $Author: dsu $
!> $Date: 2015-04-07 22:22:37 +0200 (Tue, 07 Apr 2015) $
!> $URL: https://biot.eos.ubc.ca/svn/min3p_thcm/branches/fgerard_new/src/dgm/totredx_w.F90 $
!---------------------------------------------------------------------
!********************************************************************!

!c ----------------------------------------------------------------------
!c subroutine totredx_w
!c ------------------
!c compute total source/sink term towards water concentration 
!c due to oxidation-reduction reactions or derivative thereof
!c
!c written by:      Sergi Molins - June 7, 2006
!c
!c adapted from totmin written by Uli Mayer
!c
!c definition of variables:
!c
!c I --> on input   * arbitrary  - initialized  + entries expected
!c O --> on output  * arbitrary  - unaltered    + altered
!c                                                                    I O
!c
!c passed:   totoxrdw           = total source/sink term towards      * +
!c                                water concentration
!c                                due to oxidation/reduction
!c                                reactions [moles/(l h2o*day)] 
!c                                or derivative thereof
!c           idbg               = unit number - debugging file        + -
!c
!c common:
!c chem.f:   real*8:
!c           -------
!c           rateor(nr)         = oxidation-reduction rates for       + -
!c                                redox couples [moles/(l h2o*day)]
!c           xnur(nr*nc)        = stoichiometric coefficient of       + -
!c                                component in redox couple
!c                                reaction equation
!c
!c           integer*4:
!c           ----------
!c           iars(nr)           = pointer array to secondary          + -
!c                                component of redox couple
!c           iarc(nr+1)         = row pointer array to                + -
!c                                stoichiometric coefficients in
!c                                redox reaction
!c           jarc(nr*nc)        = column pointer array to             + -
!c                                stoichiometric coefficients in
!c                                redox reaction
!c           nc                 = number of components including h2o  + -
!c           nr                 = number of redox couples             + -
!c
!c local:    real*8:
!c           -------
!c           r0                 = constant
!c           r1                 = constant
!c
!c           integer*4:
!c           ----------
!c           i                  = counter (stoichiometric
!c                                coefficients)
!c           ic                 = counter (components) 
!c           info_debug         = flag to control debugging 
!c                                information
!c           ir                 = counter (redox couples)
!c           istart             = pointer (stoichiometric 
!c                                coefficients)
!c           istop              = pointer (stoichiometric
!c                                coefficients)
!c
!c external: -
!c ----------------------------------------------------------------------
  
      subroutine totredx_w(totoxrd_w,idbg)
 
      use chem, only : nr, iarc, iars, jarc, xnur, rateor, namec
#ifdef OPENMP
      use omp_lib 
#endif 
      
      implicit none
      
      real*8 :: totoxrd_w
      integer :: idbg

      integer :: i, ic, ir, istart, istop, tid
      real*8, parameter :: r0 = 0.0d0, r1 = 1.0d0
 
#ifdef OPENMP
      tid = omp_get_thread_num() + 1
#else
      tid = 1
#endif
      totoxrd_w = r0
      
      do ir = 1,nr
        istart = iarc(ir)
        istop = iarc(ir+1)-1
        do i = istart,istop
          ic = jarc(i)
 
!c  skip h2o, since not a primary unknown
 
          if (namec(ic).eq.'h2o') then
            totoxrd_w = totoxrd_w+xnur(i)*rateor(ir,tid)
          end if
        end do

!c  add contribution from secondary component of redox couple

        ic = iars(ir)
        totoxrd_w = totoxrd_w - r1*rateor(ir,tid)

      end do

!cdbg
!c      info_debug = 0
!c
!c      if (info_debug.gt.0) then
!c        write(idbg,'(a)') 'returning from totredx ...'
!c        do ic = 1,nc-1
!c          write(idbg,'(a12,1x,e10.3)') namec(ic),totoxrd(ic)
!c        end do
!c        write(idbg,*) '----------------------------------------------'
!c      end if
!
!c      if (info_debug.gt.1) then
!c        stop
!c      end if
!cdbg
      return
      end