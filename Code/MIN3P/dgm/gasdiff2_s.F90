!*****Revision Informations Automatically Generated by VisualSVN*****!
!---------------------------------------------------------------------
!> $ID:$
!> $Revision: 296 $
!> $Author: dsu $
!> $Date: 2015-04-07 22:22:37 +0200 (Tue, 07 Apr 2015) $
!> $URL: https://biot.eos.ubc.ca/svn/min3p_thcm/branches/fgerard_new/src/dgm/gasdiff2_s.F90 $
!---------------------------------------------------------------------
!********************************************************************!

!c --------------------------------------------------------------------------
!c real*8 function gasdiff2_s
!c --------------------------
!c
!c compute diffusion coefficients for gas species using LeBlanc's approx
!c decide on weighting and call gasdiff_s.f
!c
!c written by:  Sergi Molins - May 2, 2006    
!c
!c definition of variables:
!c
!c I --> on input   * arbitrary  - initialized  + entries expected
!c O --> on output  * arbitrary  - unaltered    + altered
!c                                                                    I O
!c passed:   real*8:
!c           -------
!c           molfrac_i(ng)      = molar fraction at control volume i  + -
!c           molfrac_j(ng)      = molar fraction at control volume j  + -
!c           gpi                = gas pressure at control volume i    + -
!c           gpj                = gas pressure at control volume j    + -
!c           zgi                = elevation of control volume i       + -
!c           zgj                = elevation of control volume j       + -
!c           dens_i             = gas density at control volume i     + -
!c           dens_j             = gas density at control volume j     + -
!c           gasdiff2_s         = gas diffusion coefficient           * +
!c                                for species lg
!c
!c           integer*4:
!c           ----------
!c           lg                 = pointer to current species          + -
!c
!c           character:
!c           ----------
!c           spt_weight         = 'upstream' -> upstream weigthing    + -
!c                                'centered' -> centered weighting
!c
!c gen.f:    real*8:
!c           -------
!c           gacc               = gravity                             + -
!c
!c chem.f:   integer*4:
!c           ----------
!c           ng                 = number of gas species               + -
!c
!c local:    real*8:
!c           -------
!c           r0               = constant
!c
!c external: gasdiff.f gas diffusion using LeBlanc's approx 
!c ----------------------------------------------------------------------
 
      real*8 function gasdiff2_s(molfrac_i ,molfrac_j ,    &
                                 gpi       ,gpj       ,    &
                                 zgi       ,zgj       ,    &
                                 dens_i    ,dens_j    ,    &
                                 lg        ,               &
                                 iupsgx    ,spt_weight)

      use gen, only : gacc
      use chem, only : ng
      
	  implicit none

!c  constants
      real*8, parameter :: r0 = 0.0d0, rhalf = 0.5d0

!c  passed
      real*8       gpi       ,gpj       ,     &
                   zgi       ,zgj       ,     &
                   dens_i    ,dens_j
                                               
      real*8       molfrac_i(ng),             &
                   molfrac_j(ng)

	  integer*4    lg        
	  character*1  iupsgx
	  character*12 spt_weight

!c  internal
      real*8       hi, hj, diff, gasdiff

!c  external 
      external     gasdiff

      if (iupsgx.eq.'a') then 
	
!c       fluid potential
        hi = gpi + dens_i * gacc * zgi
        hj = gpj + dens_j * gacc * zgj

	  endif
      
!c  upstream weigthing
 
      if (spt_weight.eq.'upstream') then

        if (iupsgx.eq.'a') then
         
	      if ((hi-hj).gt.r0) then

		    diff = gasdiff(molfrac_i,lg)

          else

	        diff = gasdiff(molfrac_j,lg)

          end if
	  
	    else if (iupsgx.eq.'i') then

	      diff = gasdiff(molfrac_i,lg)

        else if (iupsgx.eq.'j') then

	      diff = gasdiff(molfrac_j,lg)

	  endif

!c  centered weigthing 

      elseif (spt_weight.eq.'centered') then

	    diff = ( gasdiff(molfrac_i,lg) +        &
                 gasdiff(molfrac_j,lg) ) * rhalf

      end if

!c  compute diffusion coefficient

      gasdiff2_s = diff

      return
      end